"use strict";exports.id=797,exports.ids=[797],exports.modules={74739:(e,t,s)=>{var r=s(25649);s.o(r,"redirect")&&s.d(t,{redirect:function(){return r.redirect}})},25649:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{ReadonlyURLSearchParams:function(){return n},RedirectType:function(){return r.RedirectType},notFound:function(){return i.notFound},permanentRedirect:function(){return r.permanentRedirect},redirect:function(){return r.redirect}});let r=s(12863),i=s(722);class a extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class n extends URLSearchParams{append(){throw new a}delete(){throw new a}set(){throw new a}sort(){throw new a}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{isNotFoundError:function(){return i},notFound:function(){return r}});let s="NEXT_NOT_FOUND";function r(){let e=Error(s);throw e.digest=s,e}function i(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===s}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},13809:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return s}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(s||(s={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},12863:(e,t,s)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{RedirectType:function(){return r},getRedirectError:function(){return l},getRedirectStatusCodeFromError:function(){return m},getRedirectTypeFromError:function(){return p},getURLFromRedirectError:function(){return h},isRedirectError:function(){return d},permanentRedirect:function(){return c},redirect:function(){return u}});let i=s(54580),a=s(72934),n=s(13809),o="NEXT_REDIRECT";function l(e,t,s){void 0===s&&(s=n.RedirectStatusCode.TemporaryRedirect);let r=Error(o);r.digest=o+";"+t+";"+e+";"+s+";";let a=i.requestAsyncStorage.getStore();return a&&(r.mutableCookies=a.mutableCookies),r}function u(e,t){void 0===t&&(t="replace");let s=a.actionAsyncStorage.getStore();throw l(e,t,(null==s?void 0:s.isAction)?n.RedirectStatusCode.SeeOther:n.RedirectStatusCode.TemporaryRedirect)}function c(e,t){void 0===t&&(t="replace");let s=a.actionAsyncStorage.getStore();throw l(e,t,(null==s?void 0:s.isAction)?n.RedirectStatusCode.SeeOther:n.RedirectStatusCode.PermanentRedirect)}function d(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,s,r,i]=e.digest.split(";",4),a=Number(i);return t===o&&("replace"===s||"push"===s)&&"string"==typeof r&&!isNaN(a)&&a in n.RedirectStatusCode}function h(e){return d(e)?e.digest.split(";",3)[2]:null}function p(e){if(!d(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function m(e){if(!d(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},96290:(e,t,s)=>{s.d(t,{jp:()=>tf});let r="https://api.x.com/2/",i="https://api.x.com/labs/2/",a="https://api.x.com/1.1/",n="https://upload.x.com/1.1/",o="https://ads-api.x.com/12/",l="https://ads-api-sandbox.twitter.com/12/";class u{constructor({realData:e,rateLimit:t,instance:s,queryParams:r,sharedParams:i}){this._maxResultsWhenFetchLast=100,this._realData=e,this._rateLimit=t,this._instance=s,this._queryParams=r,this._sharedParams=i}get _isRateLimitOk(){return!!(!this._rateLimit||1e3*this._rateLimit.reset<Date.now())||this._rateLimit.remaining>0}makeRequest(e){return this._instance.get(this.getEndpoint(),e,{fullResponse:!0,params:this._sharedParams})}makeNewInstanceFromResult(e,t){return new this.constructor({realData:e.data,rateLimit:e.rateLimit,instance:this._instance,queryParams:t,sharedParams:this._sharedParams})}getEndpoint(){return this._endpoint}injectQueryParams(e){return{...e?{max_results:e}:{},...this._queryParams}}async next(e){let t=this.getNextQueryParams(e),s=await this.makeRequest(t);return this.makeNewInstanceFromResult(s,t)}async fetchNext(e){let t=this.getNextQueryParams(e),s=await this.makeRequest(t);return await this.refreshInstanceFromResult(s,!0),this}async fetchLast(e=1/0){let t=this.getNextQueryParams(this._maxResultsWhenFetchLast),s=0;for(;s<e&&this._isRateLimitOk;){let e=await this.makeRequest(t);if(await this.refreshInstanceFromResult(e,!0),s+=this.getPageLengthFromRequest(e),this.isFetchLastOver(e))break;t=this.getNextQueryParams(this._maxResultsWhenFetchLast)}return this}get rateLimit(){var e;return{...null!==(e=this._rateLimit)&&void 0!==e?e:{}}}get data(){return this._realData}get done(){return!this.canFetchNextPage(this._realData)}*[Symbol.iterator](){yield*this.getItemArray()}async *[Symbol.asyncIterator](){yield*this.getItemArray();let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let s=await e.next(this._maxResultsWhenFetchLast);this.refreshInstanceFromResult({data:s._realData,headers:{},rateLimit:s._rateLimit},!0),t=this.canFetchNextPage(s._realData);let r=s.getItemArray();yield*r,e=s}}async *fetchAndIterate(){for(let e of this.getItemArray())yield[e,this];let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let s=await e.next(this._maxResultsWhenFetchLast);for(let e of(this.refreshInstanceFromResult({data:s._realData,headers:{},rateLimit:s._rateLimit},!0),t=this.canFetchNextPage(s._realData),s.getItemArray()))yield[e,s];this._rateLimit=s._rateLimit,e=s}}}class c extends u{async previous(e){let t=this.getPreviousQueryParams(e),s=await this.makeRequest(t);return this.makeNewInstanceFromResult(s,t)}async fetchPrevious(e){let t=this.getPreviousQueryParams(e),s=await this.makeRequest(t);return await this.refreshInstanceFromResult(s,!1),this}}let d=u;class h extends d{getNextQueryParams(e){var t;return{...this._queryParams,cursor:null!==(t=this._realData.next_cursor_str)&&void 0!==t?t:this._realData.next_cursor,...e?{count:e}:{}}}isFetchLastOver(e){return!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!this.isNextCursorInvalid(e.next_cursor)||!this.isNextCursorInvalid(e.next_cursor_str)}isNextCursorInvalid(e){return void 0===e||0===e||-1===e||"0"===e||"-1"===e}}class p extends h{constructor(){super(...arguments),this._endpoint="direct_messages/events/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.events.push(...s.events),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.events.length}getItemArray(){return this.events}get events(){return this._realData.events}}class m extends h{constructor(){super(...arguments),this._endpoint="direct_messages/welcome_messages/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.welcome_messages.push(...s.welcome_messages),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.welcome_messages.length}getItemArray(){return this.welcomeMessages}get welcomeMessages(){return this._realData.welcome_messages}}(function(e){e.Jpeg="image/jpeg",e.Mp4="video/mp4",e.Mov="video/quicktime",e.Gif="image/gif",e.Png="image/png",e.Srt="text/plain",e.Webp="image/webp"})(v||(v={})),function(e){e.Create="message_create",e.WelcomeCreate="welcome_message"}(b||(b={})),function(e){e.Request="request",e.PartialResponse="partial-response",e.Response="response"}(R||(R={}));class g extends Error{constructor(){super(...arguments),this.error=!0}}class f extends g{constructor(e,t){super(e),this.type=R.Request,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get requestError(){return this._options.requestError}toJSON(){return{type:this.type,error:this.requestError}}}class _ extends g{constructor(e,t){super(e),this.type=R.PartialResponse,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get response(){return this._options.response}get responseError(){return this._options.responseError}get rawContent(){return this._options.rawContent}toJSON(){return{type:this.type,error:this.responseError}}}class y extends g{constructor(e,t){if(super(e),this.type=R.Response,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t}),this.code=t.code,this.headers=t.headers,this.rateLimit=t.rateLimit,t.data&&"object"==typeof t.data&&"error"in t.data&&!t.data.errors){let e={...t.data};e.errors=[{code:x.InternalError,message:e.error}],this.data=e}else this.data=t.data}get request(){return this._options.request}get response(){return this._options.response}hasErrorCode(...e){let t=this.errors;if(!(null==t?void 0:t.length))return!1;if("code"in t[0])return t.some(t=>e.includes(t.code));let s=this.data;return e.includes(s.type)}get errors(){var e;return null===(e=this.data)||void 0===e?void 0:e.errors}get rateLimitError(){return 420===this.code||429===this.code}get isAuthError(){return 401===this.code||this.hasErrorCode(x.AuthTimestampInvalid,x.AuthenticationFail,x.BadAuthenticationData,x.InvalidOrExpiredToken)}toJSON(){return{type:this.type,code:this.code,error:this.data,rateLimit:this.rateLimit,headers:this.headers}}}(function(e){e[e.InvalidCoordinates=3]="InvalidCoordinates",e[e.NoLocationFound=13]="NoLocationFound",e[e.AuthenticationFail=32]="AuthenticationFail",e[e.InvalidOrExpiredToken=89]="InvalidOrExpiredToken",e[e.UnableToVerifyCredentials=99]="UnableToVerifyCredentials",e[e.AuthTimestampInvalid=135]="AuthTimestampInvalid",e[e.BadAuthenticationData=215]="BadAuthenticationData",e[e.NoUserMatch=17]="NoUserMatch",e[e.UserNotFound=50]="UserNotFound",e[e.ResourceNotFound=34]="ResourceNotFound",e[e.TweetNotFound=144]="TweetNotFound",e[e.TweetNotVisible=179]="TweetNotVisible",e[e.NotAllowedResource=220]="NotAllowedResource",e[e.MediaIdNotFound=325]="MediaIdNotFound",e[e.TweetNoLongerAvailable=421]="TweetNoLongerAvailable",e[e.TweetViolatedRules=422]="TweetViolatedRules",e[e.TargetUserSuspended=63]="TargetUserSuspended",e[e.YouAreSuspended=64]="YouAreSuspended",e[e.AccountUpdateFailed=120]="AccountUpdateFailed",e[e.NoSelfSpamReport=36]="NoSelfSpamReport",e[e.NoSelfMute=271]="NoSelfMute",e[e.AccountLocked=326]="AccountLocked",e[e.RateLimitExceeded=88]="RateLimitExceeded",e[e.NoDMRightForApp=93]="NoDMRightForApp",e[e.OverCapacity=130]="OverCapacity",e[e.InternalError=131]="InternalError",e[e.TooManyFollowings=161]="TooManyFollowings",e[e.TweetLimitExceeded=185]="TweetLimitExceeded",e[e.DuplicatedTweet=187]="DuplicatedTweet",e[e.TooManySpamReports=205]="TooManySpamReports",e[e.RequestLooksLikeSpam=226]="RequestLooksLikeSpam",e[e.NoWriteRightForApp=261]="NoWriteRightForApp",e[e.TweetActionsDisabled=425]="TweetActionsDisabled",e[e.TweetRepliesRestricted=433]="TweetRepliesRestricted",e[e.NamedParameterMissing=38]="NamedParameterMissing",e[e.InvalidAttachmentUrl=44]="InvalidAttachmentUrl",e[e.TweetTextTooLong=186]="TweetTextTooLong",e[e.MissingUrlParameter=195]="MissingUrlParameter",e[e.NoMultipleGifs=323]="NoMultipleGifs",e[e.InvalidMediaIds=324]="InvalidMediaIds",e[e.InvalidUrl=407]="InvalidUrl",e[e.TooManyTweetAttachments=386]="TooManyTweetAttachments",e[e.StatusAlreadyFavorited=139]="StatusAlreadyFavorited",e[e.FollowRequestAlreadySent=160]="FollowRequestAlreadySent",e[e.CannotUnmuteANonMutedAccount=272]="CannotUnmuteANonMutedAccount",e[e.TweetAlreadyRetweeted=327]="TweetAlreadyRetweeted",e[e.ReplyToDeletedTweet=385]="ReplyToDeletedTweet",e[e.DMReceiverNotFollowingYou=150]="DMReceiverNotFollowingYou",e[e.UnableToSendDM=151]="UnableToSendDM",e[e.MustAllowDMFromAnyone=214]="MustAllowDMFromAnyone",e[e.CannotSendDMToThisUser=349]="CannotSendDMToThisUser",e[e.DMTextTooLong=354]="DMTextTooLong",e[e.SubscriptionAlreadyExists=355]="SubscriptionAlreadyExists",e[e.CallbackUrlNotApproved=415]="CallbackUrlNotApproved",e[e.SuspendedApplication=416]="SuspendedApplication",e[e.OobOauthIsNotAllowed=417]="OobOauthIsNotAllowed"})(x||(x={})),function(e){e.InvalidRequest="https://developer.x.com/en/support/x-api/error-troubleshooting#invalid-request",e.ClientForbidden="https://developer.x.com/en/support/x-api/error-troubleshooting#client-forbidden",e.UnsupportedAuthentication="https://developer.x.com/en/support/x-api/error-troubleshooting#unsupported-authentication",e.InvalidRules="https://developer.x.com/en/support/x-api/error-troubleshooting#invalid-rules",e.TooManyRules="https://developer.x.com/en/support/x-api/error-troubleshooting#rule-cap",e.DuplicatedRules="https://developer.x.com/en/support/x-api/error-troubleshooting#duplicate-rules",e.RateLimitExceeded="https://developer.x.com/en/support/x-api/error-troubleshooting#usage-capped",e.ConnectionError="https://developer.x.com/en/support/x-api/error-troubleshooting#streaming-connection",e.ClientDisconnected="https://developer.x.com/en/support/x-api/error-troubleshooting#client-disconnected",e.TwitterDisconnectedYou="https://developer.x.com/en/support/x-api/error-troubleshooting#operational-disconnect",e.ResourceNotFound="https://developer.x.com/en/support/x-api/error-troubleshooting#resource-not-found",e.ResourceUnauthorized="https://developer.x.com/en/support/x-api/error-troubleshooting#not-authorized-for-resource",e.DisallowedResource="https://developer.x.com/en/support/x-api/error-troubleshooting#disallowed-resource"}(k||(k={})),function(e){e.Connected="connected",e.ConnectError="connect error",e.ConnectionError="connection error",e.ConnectionClosed="connection closed",e.ConnectionLost="connection lost",e.ReconnectAttempt="reconnect attempt",e.Reconnected="reconnected",e.ReconnectError="reconnect error",e.ReconnectLimitExceeded="reconnect limit exceeded",e.DataKeepAlive="data keep-alive",e.Data="data event content",e.DataError="data twitter error",e.TweetParseError="data tweet parse error",e.Error="stream error"}(S||(S={}));class w{constructor(e){this.value=e}}var v,b,R,x,k,S,T,D=s(57147);let E={debug:!1,deprecationWarnings:!0,logger:{log:console.log.bind(console)}};function q(e){let t={value:void 0,promise:e().then(e=>(t.value=e,e))};return t}function L(e){return Array.isArray(e)?e:[e]}function A(e){return"object"==typeof e&&"errors"in e&&!("data"in e)}function P(e){return!!Array.isArray(e)&&e.length>1||e.toString().includes(",")}let I=new Set;function j(e){if("undefined"==typeof console||!console.warn||!E.deprecationWarnings)return;let t=`${e.instance}-${e.method}-${e.problem}`;I.has(t)||(console.warn(`[twitter-api-v2] Deprecation warning: In ${e.instance}.${e.method}() call, ${e.problem}.
${e.resolution}.`),console.warn("To disable this message, import variable TwitterApiV2Settings from twitter-api-v2 and set TwitterApiV2Settings.deprecationWarnings to false."),I.add(t))}var M=s(82361),C=s(95687),F=s(59796);class O{constructor(e){this.requestData=e,this.requestErrorHandled=!1,this.responseData=[]}get hrefPathname(){let e=this.requestData.url;return e.hostname+e.pathname}isCompressionDisabled(){return!this.requestData.compression||"identity"===this.requestData.compression}isFormEncodedEndpoint(){return this.requestData.url.href.startsWith("https://api.x.com/oauth/")}createRequestError(e){return E.debug&&E.logger.log("Request error:",e),new f("Request failed.",{request:this.req,error:e})}createPartialResponseError(e,t){let s=this.res,r=`Request failed with partial response with HTTP code ${s.statusCode}`;return t?r+=" (connection abruptly closed)":r+=" (parse error)",new _(r,{request:this.req,response:this.res,responseError:e,rawContent:Buffer.concat(this.responseData).toString()})}formatV1Errors(e){return e.map(({code:e,message:t})=>`${t} (Twitter code ${e})`).join(", ")}formatV2Error(e){return`${e.title}: ${e.detail} (see ${e.type})`}createResponseError({res:e,data:t,rateLimit:s,code:r}){var i;E.debug&&(E.logger.log(`Request failed with code ${r}, data:`,t),E.logger.log("Response headers:",e.headers));let a=`Request failed with code ${r}`;if(null===(i=null==t?void 0:t.errors)||void 0===i?void 0:i.length){let e=t.errors;"object"==typeof e[0]&&"code"in e[0]?a+=" - "+this.formatV1Errors(e):a+=" - "+this.formatV2Error(t)}return new y(a,{code:r,data:t,headers:e.headers,request:this.req,response:e,rateLimit:s})}getResponseDataStream(e){if(this.isCompressionDisabled())return e;let t=(e.headers["content-encoding"]||"identity").trim().toLowerCase();if("br"===t){let t=F.createBrotliDecompress({flush:F.constants.BROTLI_OPERATION_FLUSH,finishFlush:F.constants.BROTLI_OPERATION_FLUSH});return e.pipe(t),t}if("gzip"===t){let t=F.createGunzip({flush:F.constants.Z_SYNC_FLUSH,finishFlush:F.constants.Z_SYNC_FLUSH});return e.pipe(t),t}if("deflate"===t){let t=F.createInflate({flush:F.constants.Z_SYNC_FLUSH,finishFlush:F.constants.Z_SYNC_FLUSH});return e.pipe(t),t}return e}detectResponseType(e){var t,s;return(null===(t=e.headers["content-type"])||void 0===t?void 0:t.includes("application/json"))||(null===(s=e.headers["content-type"])||void 0===s?void 0:s.includes("application/problem+json"))?"json":this.isFormEncodedEndpoint()?"url":"text"}getParsedResponse(e){let t=this.responseData,s=this.requestData.forceParseMode||this.detectResponseType(e);if("buffer"===s)return Buffer.concat(t);if("text"===s)return Buffer.concat(t).toString();if("json"===s){let e=Buffer.concat(t).toString();return e.length?JSON.parse(e):void 0}{if("url"!==s)return;let e=Buffer.concat(t).toString(),r={};for(let[t,s]of new URLSearchParams(e))r[t]=s;return r}}getRateLimitFromResponse(e){let t;return e.headers["x-rate-limit-limit"]&&(t={limit:Number(e.headers["x-rate-limit-limit"]),remaining:Number(e.headers["x-rate-limit-remaining"]),reset:Number(e.headers["x-rate-limit-reset"])},e.headers["x-app-limit-24hour-limit"]&&(t.day={limit:Number(e.headers["x-app-limit-24hour-limit"]),remaining:Number(e.headers["x-app-limit-24hour-remaining"]),reset:Number(e.headers["x-app-limit-24hour-reset"])}),this.requestData.rateLimitSaver&&this.requestData.rateLimitSaver(t)),t}onSocketEventHandler(e,t,s){let r=this.onSocketCloseHandler.bind(this,e);s.on("close",r),t.on("complete",()=>s.off("close",r))}onSocketCloseHandler(e){if(this.req.removeAllListeners("timeout"),!this.res&&!this.requestErrorHandled)return e(this.createRequestError(Error("Socket closed without any information.")))}requestErrorHandler(e,t){var s,r;null===(r=(s=this.requestData).requestEventDebugHandler)||void 0===r||r.call(s,"request-error",{requestError:t}),this.requestErrorHandled=!0,e(this.createRequestError(t))}timeoutErrorHandler(){this.requestErrorHandled=!0,this.req.destroy(Error("Request timeout."))}classicResponseHandler(e,t,s){this.res=s;let r=this.getResponseDataStream(s);r.on("data",e=>this.responseData.push(e)),r.on("end",this.onResponseEndHandler.bind(this,e,t)),r.on("close",this.onResponseCloseHandler.bind(this,e,t)),this.requestData.requestEventDebugHandler&&(this.requestData.requestEventDebugHandler("response",{res:s}),s.on("aborted",e=>this.requestData.requestEventDebugHandler("response-aborted",{error:e})),s.on("error",e=>this.requestData.requestEventDebugHandler("response-error",{error:e})),s.on("close",()=>this.requestData.requestEventDebugHandler("response-close",{data:this.responseData})),s.on("end",()=>this.requestData.requestEventDebugHandler("response-end")))}onResponseEndHandler(e,t){let s;let r=this.getRateLimitFromResponse(this.res);try{s=this.getParsedResponse(this.res)}catch(e){t(this.createPartialResponseError(e,!1));return}let i=this.res.statusCode;if(i>=400){t(this.createResponseError({data:s,res:this.res,rateLimit:r,code:i}));return}E.debug&&(E.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`),E.logger.log("Response body:",s)),e({data:s,headers:this.res.headers,rateLimit:r})}onResponseCloseHandler(e,t){let s=this.res;if(s.aborted)try{return this.getParsedResponse(this.res),this.onResponseEndHandler(e,t)}catch(e){return t(this.createPartialResponseError(e,!0))}if(!s.complete)return t(this.createPartialResponseError(Error("Response has been interrupted before response could be parsed."),!0))}streamResponseHandler(e,t,s){if(s.statusCode<400){E.debug&&E.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${s.statusCode} (starting stream)`);let t=this.getResponseDataStream(s);e({req:this.req,res:t,originalResponse:s,requestData:this.requestData})}else this.classicResponseHandler(()=>void 0,t,s)}debugRequest(){let e=this.requestData.url;E.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`,this.requestData.options),e.search&&E.logger.log("Request parameters:",[...e.searchParams.entries()].map(([e,t])=>`${e}: ${t}`)),this.requestData.body&&E.logger.log("Request body:",this.requestData.body)}buildRequest(){var e;let t=this.requestData.url,s=t.username?`${t.username}:${t.password}`:void 0,r=null!==(e=this.requestData.options.headers)&&void 0!==e?e:{};!0===this.requestData.compression||"brotli"===this.requestData.compression?r["accept-encoding"]="br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1":"gzip"===this.requestData.compression?r["accept-encoding"]="gzip;q=1, deflate;q=0.5, *;q=0.1":"deflate"===this.requestData.compression&&(r["accept-encoding"]="deflate;q=1, *;q=0.1"),E.debug&&this.debugRequest(),this.req=(0,C.request)({...this.requestData.options,host:t.hostname,port:t.port||void 0,path:t.pathname+t.search,protocol:t.protocol,auth:s,headers:r})}registerRequestEventDebugHandlers(e){e.on("close",()=>this.requestData.requestEventDebugHandler("close")),e.on("abort",()=>this.requestData.requestEventDebugHandler("abort")),e.on("socket",e=>{this.requestData.requestEventDebugHandler("socket",{socket:e}),e.on("error",t=>this.requestData.requestEventDebugHandler("socket-error",{socket:e,error:t})),e.on("connect",()=>this.requestData.requestEventDebugHandler("socket-connect",{socket:e})),e.on("close",t=>this.requestData.requestEventDebugHandler("socket-close",{socket:e,withError:t})),e.on("end",()=>this.requestData.requestEventDebugHandler("socket-end",{socket:e})),e.on("lookup",(...t)=>this.requestData.requestEventDebugHandler("socket-lookup",{socket:e,data:t})),e.on("timeout",()=>this.requestData.requestEventDebugHandler("socket-timeout",{socket:e}))})}makeRequest(){return this.buildRequest(),new Promise((e,t)=>{let s=e=>{r.emit("complete"),t(e)},r=new M.EventEmitter,i=this.req;i.on("error",this.requestErrorHandler.bind(this,s)),i.on("socket",this.onSocketEventHandler.bind(this,s,r)),i.on("response",this.classicResponseHandler.bind(this,t=>{r.emit("complete"),e(t)},s)),this.requestData.options.timeout&&i.on("timeout",this.timeoutErrorHandler.bind(this)),this.requestData.requestEventDebugHandler&&this.registerRequestEventDebugHandlers(i),this.requestData.body&&i.write(this.requestData.body),i.end()})}async makeRequestAsStream(){let{req:e,res:t,requestData:s,originalResponse:r}=await this.makeRequestAndResolveWhenReady();return new $(s,{req:e,res:t,originalResponse:r})}makeRequestAndResolveWhenReady(){return this.buildRequest(),new Promise((e,t)=>{let s=this.req;s.on("error",this.requestErrorHandler.bind(this,t)),s.on("response",this.streamResponseHandler.bind(this,e,t)),this.requestData.body&&s.write(this.requestData.body),s.end()})}}class N extends M.EventEmitter{constructor(e){super(),this.stream=e,this.stack=[],this.onStreamData=this.onStreamData.bind(this),this.onStreamError=this.onStreamError.bind(this),this.onceNewEvent=this.once.bind(this,"event"),e.on(S.Data,this.onStreamData),e.on(S.ConnectionError,this.onStreamError),e.on(S.TweetParseError,this.onStreamError),e.on(S.ConnectionClosed,this.onStreamError)}nextEvent(){return new Promise(this.onceNewEvent)}hasStack(){return this.stack.length>0}popStack(){let e=this.stack;return this.stack=[],e}destroy(){this.removeAllListeners(),this.stream.off(S.Data,this.onStreamData),this.stream.off(S.ConnectionError,this.onStreamError),this.stream.off(S.TweetParseError,this.onStreamError),this.stream.off(S.ConnectionClosed,this.onStreamError)}emitEvent(e,t){this.emit("event",{type:e,payload:t})}onStreamError(e){this.emitEvent("error",e)}onStreamData(e){this.stack.push(e),this.emitEvent("data",e)}}class U extends M.EventEmitter{constructor(){super(...arguments),this.currentMessage=""}push(e){this.currentMessage+=e;let t=(e=this.currentMessage).length,s=0,r=0;for(;r<t;){if("\r\n"===e.slice(r,r+2)){let t=e.slice(s,r);if(s=r+=2,!t.length)continue;try{let e=JSON.parse(t);if(e){this.emit(T.ParsedData,e);continue}}catch(e){this.emit(T.ParseError,e)}}r++}this.currentMessage=e.slice(s,t)}reset(){this.currentMessage=""}}!function(e){e.ParsedData="parsed data",e.ParseError="parse error"}(T||(T={}));let B=[5,15,30,60,90,120,180,300,600,900],z=e=>e>B.length?901e3:1e3*B[e-1];class H extends M.EventEmitter{constructor(e,t){super(),this.requestData=e,this.autoReconnect=!1,this.autoReconnectRetries=5,this.keepAliveTimeoutMs=12e4,this.nextRetryTimeout=z,this.parser=new U,this.connectionProcessRunning=!1,this.onKeepAliveTimeout=this.onKeepAliveTimeout.bind(this),this.initEventsFromParser(),t&&(this.req=t.req,this.res=t.res,this.originalResponse=t.originalResponse,this.initEventsFromRequest())}on(e,t){return super.on(e,t)}initEventsFromRequest(){if(!this.req||!this.res)throw Error("TweetStream error: You cannot init TweetStream without a request and response object.");let e=e=>{this.emit(S.ConnectionError,e),this.emit(S.Error,{type:S.ConnectionError,error:e,message:"Connection lost or closed by Twitter."}),this.onConnectionError()};this.req.on("error",e),this.res.on("error",e),this.res.on("close",()=>e(Error("Connection closed by Twitter."))),this.res.on("data",e=>{if(this.resetKeepAliveTimeout(),"\r\n"===e.toString())return this.emit(S.DataKeepAlive);this.parser.push(e.toString())}),this.resetKeepAliveTimeout()}initEventsFromParser(){let e=this.requestData.payloadIsError;this.parser.on(T.ParsedData,t=>{e&&e(t)?(this.emit(S.DataError,t),this.emit(S.Error,{type:S.DataError,error:t,message:"Twitter sent a payload that is detected as an error payload."})):this.emit(S.Data,t)}),this.parser.on(T.ParseError,e=>{this.emit(S.TweetParseError,e),this.emit(S.Error,{type:S.TweetParseError,error:e,message:"Failed to parse stream data."})})}resetKeepAliveTimeout(){this.unbindKeepAliveTimeout(),this.keepAliveTimeoutMs!==1/0&&(this.keepAliveTimeout=setTimeout(this.onKeepAliveTimeout,this.keepAliveTimeoutMs))}onKeepAliveTimeout(){this.emit(S.ConnectionLost),this.onConnectionError()}unbindTimeouts(){this.unbindRetryTimeout(),this.unbindKeepAliveTimeout()}unbindKeepAliveTimeout(){this.keepAliveTimeout&&(clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=void 0)}unbindRetryTimeout(){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}closeWithoutEmit(){this.unbindTimeouts(),this.res&&(this.res.removeAllListeners(),this.res.destroy()),this.req&&(this.req.removeAllListeners(),this.req.destroy())}close(){this.emit(S.ConnectionClosed),this.closeWithoutEmit()}destroy(){this.removeAllListeners(),this.close()}async clone(){let e=new O(this.requestData),t=await e.makeRequestAsStream();for(let e of this.eventNames())for(let s of this.listeners(e))t.on(e,s);return t}async connect(e={}){void 0!==e.autoReconnect&&(this.autoReconnect=e.autoReconnect),void 0!==e.autoReconnectRetries&&(this.autoReconnectRetries="unlimited"===e.autoReconnectRetries?1/0:e.autoReconnectRetries),void 0!==e.keepAliveTimeout&&(this.keepAliveTimeoutMs="disable"===e.keepAliveTimeout?1/0:e.keepAliveTimeout),void 0!==e.nextRetryTimeout&&(this.nextRetryTimeout=e.nextRetryTimeout),this.unbindTimeouts();try{await this.reconnect()}catch(e){if(this.emit(S.ConnectError,0),this.emit(S.Error,{type:S.ConnectError,error:e,message:"Connect error - Initial connection just failed."}),this.autoReconnect)this.makeAutoReconnectRetry(0,e);else throw e}return this}async reconnect(){if(this.connectionProcessRunning)throw Error("Connection process is already running.");this.connectionProcessRunning=!0;try{let e=!0;this.req&&(e=!1,this.closeWithoutEmit());let{req:t,res:s,originalResponse:r}=await new O(this.requestData).makeRequestAndResolveWhenReady();this.req=t,this.res=s,this.originalResponse=r,this.emit(e?S.Connected:S.Reconnected),this.parser.reset(),this.initEventsFromRequest()}finally{this.connectionProcessRunning=!1}}async onConnectionError(e=0){if(this.unbindTimeouts(),this.closeWithoutEmit(),!this.autoReconnect){this.emit(S.ConnectionClosed);return}if(e>=this.autoReconnectRetries){this.emit(S.ReconnectLimitExceeded),this.emit(S.ConnectionClosed);return}try{this.emit(S.ReconnectAttempt,e),await this.reconnect()}catch(t){this.emit(S.ReconnectError,e),this.emit(S.Error,{type:S.ReconnectError,error:t,message:`Reconnect error - ${e+1} attempts made yet.`}),this.makeAutoReconnectRetry(e,t)}}makeAutoReconnectRetry(e,t){let s=this.nextRetryTimeout(e+1,t);this.retryTimeout=setTimeout(()=>{this.onConnectionError(e+1)},s)}async *[Symbol.asyncIterator](){let e=new N(this);try{for(;;){if(!this.req||this.req.aborted)throw Error("Connection closed");e.hasStack()&&(yield*e.popStack());let{type:t,payload:s}=await e.nextEvent();if("error"===t)throw s}}finally{e.destroy()}}}let $=H;async function W(e,t,s,r){let i;return(r instanceof f||r instanceof _?i=await this.applyPluginMethod("onRequestError",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s,error:r}):r instanceof y&&(i=await this.applyPluginMethod("onResponseError",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s,error:r})),i&&i instanceof w)?i.value:Promise.reject(r)}var V=s(6113);class K{constructor(e){this.nonceLength=32,this.consumerKeys=e.consumerKeys}static percentEncode(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}hash(e,t){return V.createHmac("sha1",t).update(e).digest("base64")}authorize(e,t={}){let s={oauth_consumer_key:this.consumerKeys.key,oauth_nonce:this.getNonce(),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:this.getTimestamp(),oauth_version:"1.0"};return void 0!==t.key&&(s.oauth_token=t.key),e.data||(e.data={}),s.oauth_signature=this.getSignature(e,t.secret,s),s}toHeader(e){let t=Q(e),s="OAuth ";for(let e of t)0===e.key.indexOf("oauth_")&&(s+=K.percentEncode(e.key)+'="'+K.percentEncode(e.value)+'",');return{Authorization:s.slice(0,s.length-1)}}getNonce(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let s=0;s<this.nonceLength;s++)t+=e[Math.trunc(Math.random()*e.length)];return t}getTimestamp(){return Math.trunc(new Date().getTime()/1e3)}getSignature(e,t,s){return this.hash(this.getBaseString(e,s),this.getSigningKey(t))}getSigningKey(e){return K.percentEncode(this.consumerKeys.secret)+"&"+K.percentEncode(e||"")}getBaseString(e,t){return e.method.toUpperCase()+"&"+K.percentEncode(this.getBaseUrl(e.url))+"&"+K.percentEncode(this.getParameterString(e,t))}getParameterString(e,t){let s=Q(function(e){let t={};for(let s in e){let r=e[s];r=r&&Array.isArray(r)?r.map(e=>K.percentEncode(e)):K.percentEncode(r),t[K.percentEncode(s)]=r}return t}(J(t,J(e.data,function(e){let t=e.split("?");return 1===t.length?{}:function(e){let t=e.split("&"),s={};for(let e of t){let[t,r=""]=e.split("=");s[t]?(Array.isArray(s[t])||(s[t]=[s[t]]),s[t].push(decodeURIComponent(r))):s[t]=decodeURIComponent(r)}return s}(t[1])}(e.url))))),r="";for(let{key:e,value:t}of s)if(t&&Array.isArray(t)){t.sort();let s="";t.forEach((r,i)=>{s+=e+"="+r,i<t.length&&(s+="&")}),r+=s}else r+=e+"="+t+"&";return r.slice(0,r.length-1)}getBaseUrl(e){return e.split("?")[0]}}function J(e,t){return{...e||{},...t||{}}}function Q(e){return Object.keys(e).sort().map(t=>({key:t,value:e[t]}))}class G{constructor(){this._boundary="",this._chunks=[]}bodyAppend(...e){let t=e.map(e=>e instanceof Buffer?e:Buffer.from(e));this._chunks.push(...t)}append(e,t,s){let r=t instanceof Buffer?t:t.toString(),i=this.getMultipartHeader(e,r,s);this.bodyAppend(i,r,G.LINE_BREAK)}getHeaders(){return{"content-type":"multipart/form-data; boundary="+this.getBoundary()}}getLength(){return this._chunks.reduce((e,t)=>e+t.length,this.getMultipartFooter().length)}getBuffer(){let e=[...this._chunks,this.getMultipartFooter()],t=Buffer.alloc(this.getLength()),s=0;for(let r of e)for(let e=0;e<r.length;s++,e++)t[s]=r[e];return t}getBoundary(){return this._boundary||this.generateBoundary(),this._boundary}generateBoundary(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(10*Math.random()).toString(16);this._boundary=e}getMultipartHeader(e,t,s){s||(s=t instanceof Buffer?G.DEFAULT_CONTENT_TYPE:"");let r="";for(let[t,i]of Object.entries({"Content-Disposition":["form-data",`name="${e}"`],"Content-Type":s}))i.length&&(r+=t+": "+L(i).join("; ")+G.LINE_BREAK);return"--"+this.getBoundary()+G.LINE_BREAK+r+G.LINE_BREAK}getMultipartFooter(){return this._footerChunk?this._footerChunk:this._footerChunk=Buffer.from("--"+this.getBoundary()+"--"+G.LINE_BREAK)}}G.LINE_BREAK="\r\n",G.DEFAULT_CONTENT_TYPE="application/octet-stream";class Y{static formatQueryToString(e){let t={};for(let s in e)"string"==typeof e[s]?t[s]=e[s]:void 0!==e[s]&&(t[s]=String(e[s]));return t}static autoDetectBodyType(e){if(e.pathname.startsWith("/2/")||e.pathname.startsWith("/labs/2/"))return e.password.startsWith("/2/oauth2")?"url":"json";if("upload.x.com"===e.hostname)return"/1.1/media/upload.json"===e.pathname?"form-data":"json";let t=e.pathname.split("/1.1/",2)[1];return this.JSON_1_1_ENDPOINTS.has(t)?"json":"url"}static addQueryParamsToUrl(e,t){let s=Object.entries(t);if(s.length){let t="";for(let[e,r]of s)t+=(t.length?"&":"?")+`${K.percentEncode(e)}=${K.percentEncode(r)}`;e.search=t}}static constructBodyParams(e,t,s){if(e instanceof Buffer)return e;if("json"===s)return t["content-type"]||(t["content-type"]="application/json;charset=UTF-8"),JSON.stringify(e);if("url"===s)return(t["content-type"]||(t["content-type"]="application/x-www-form-urlencoded;charset=UTF-8"),Object.keys(e).length)?new URLSearchParams(e).toString().replace(/\*/g,"%2A"):"";if("raw"===s)throw Error("You can only use raw body mode with Buffers. To give a string, use Buffer.from(str).");{let s=new G;for(let t in e)s.append(t,e[t]);if(!t["content-type"]){let e=s.getHeaders();t["content-type"]=e["content-type"]}return s.getBuffer()}}static setBodyLengthHeader(e,t){var s;e.headers=null!==(s=e.headers)&&void 0!==s?s:{},"string"==typeof t?e.headers["content-length"]=Buffer.byteLength(t):e.headers["content-length"]=t.length}static isOAuthSerializable(e){return!(e instanceof Buffer)}static mergeQueryAndBodyForOAuth(e,t){let s={};for(let t in e)s[t]=e[t];if(this.isOAuthSerializable(t))for(let e in t){let r=t[e];this.isOAuthSerializable(r)&&(s[e]="object"==typeof r&&null!==r&&"toString"in r?r.toString():r)}return s}static moveUrlQueryParamsIntoObject(e,t){for(let[s,r]of e.searchParams)t[s]=r;return e.search="",e}static applyRequestParametersToUrl(e,t){return e.pathname=e.pathname.replace(/:([A-Z_-]+)/ig,(e,s)=>void 0!==t[s]?String(t[s]):e),e}}Y.JSON_1_1_ENDPOINTS=new Set(["direct_messages/events/new.json","direct_messages/welcome_messages/new.json","direct_messages/welcome_messages/rules/new.json","media/metadata/create.json","collections/entries/curate.json"]);class Z{static getCodeVerifier(){return this.generateRandomString(128)}static getCodeChallengeFromVerifier(e){return this.escapeBase64Url(V.createHash("sha256").update(e).digest("base64"))}static getAuthHeader(e,t){let s=encodeURIComponent(e)+":"+encodeURIComponent(t);return Buffer.from(s).toString("base64")}static generateRandomString(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";for(let r=0;r<e;r++)t+=s[Math.floor(Math.random()*s.length)];return t}static escapeBase64Url(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}}class X{constructor(e){this.rateLimits={},this.clientSettings={},e&&(this.clientSettings=e)}getRateLimits(){return this.rateLimits}saveRateLimit(e,t){this.rateLimits[e]=t}async send(e){var t,s,r,i,a;if(null===(t=this.clientSettings.plugins)||void 0===t?void 0:t.length){let t=await this.applyPreRequestConfigHooks(e);if(t)return t}let n=this.getHttpRequestArgs(e),o={method:n.method,headers:n.headers,timeout:e.timeout,agent:this.clientSettings.httpAgent},l=!1!==e.enableRateLimitSave;n.body&&Y.setBodyLengthHeader(o,n.body),(null===(s=this.clientSettings.plugins)||void 0===s?void 0:s.length)&&await this.applyPreRequestHooks(e,n,o);let u=new O({url:n.url,options:o,body:n.body,rateLimitSaver:l?this.saveRateLimit.bind(this,n.rawUrl):void 0,requestEventDebugHandler:e.requestEventDebugHandler,compression:null===(i=null!==(r=e.compression)&&void 0!==r?r:this.clientSettings.compression)||void 0===i||i,forceParseMode:e.forceParseMode}).makeRequest();(function(e){var t;if(!(null===(t=e.clientSettings.plugins)||void 0===t?void 0:t.length))return!1;for(let t of e.clientSettings.plugins)if(t.onRequestError||t.onResponseError)return!0;return!1})(this)&&(u=this.applyResponseErrorHooks(e,n,o,u));let c=await u;if(null===(a=this.clientSettings.plugins)||void 0===a?void 0:a.length){let t=await this.applyPostRequestHooks(e,n,o,c);if(t)return t.value}return c}sendStream(e){var t,s;this.clientSettings.plugins&&this.applyPreStreamRequestConfigHooks(e);let r=this.getHttpRequestArgs(e),i={method:r.method,headers:r.headers,agent:this.clientSettings.httpAgent},a=!1!==e.enableRateLimitSave,n=!1!==e.autoConnect;r.body&&Y.setBodyLengthHeader(i,r.body);let o=new $({url:r.url,options:i,body:r.body,rateLimitSaver:a?this.saveRateLimit.bind(this,r.rawUrl):void 0,payloadIsError:e.payloadIsError,compression:null===(s=null!==(t=e.compression)&&void 0!==t?t:this.clientSettings.compression)||void 0===s||s});return n?o.connect():o}initializeToken(e){if("string"==typeof e)this.bearerToken=e;else if("object"==typeof e&&"appKey"in e)this.consumerToken=e.appKey,this.consumerSecret=e.appSecret,e.accessToken&&e.accessSecret&&(this.accessToken=e.accessToken,this.accessSecret=e.accessSecret),this._oauth=this.buildOAuth();else if("object"==typeof e&&"username"in e){let t=encodeURIComponent(e.username)+":"+encodeURIComponent(e.password);this.basicToken=Buffer.from(t).toString("base64")}else"object"==typeof e&&"clientId"in e&&(this.clientId=e.clientId,this.clientSecret=e.clientSecret)}getActiveTokens(){return this.bearerToken?{type:"oauth2",bearerToken:this.bearerToken}:this.basicToken?{type:"basic",token:this.basicToken}:this.consumerSecret&&this._oauth?{type:"oauth-1.0a",appKey:this.consumerToken,appSecret:this.consumerSecret,accessToken:this.accessToken,accessSecret:this.accessSecret}:this.clientId?{type:"oauth2-user",clientId:this.clientId}:{type:"none"}}buildOAuth(){if(!this.consumerSecret||!this.consumerToken)throw Error("Invalid consumer tokens");return new K({consumerKeys:{key:this.consumerToken,secret:this.consumerSecret}})}getOAuthAccessTokens(){if(this.accessSecret&&this.accessToken)return{key:this.accessToken,secret:this.accessSecret}}getPlugins(){var e;return null!==(e=this.clientSettings.plugins)&&void 0!==e?e:[]}hasPlugins(){var e;return!!(null===(e=this.clientSettings.plugins)||void 0===e?void 0:e.length)}async applyPluginMethod(e,t){var s;let r;for(let i of this.getPlugins()){let a=await (null===(s=i[e])||void 0===s?void 0:s.call(i,t));a&&a instanceof w&&(r=a)}return r}writeAuthHeaders({headers:e,bodyInSignature:t,url:s,method:r,query:i,body:a}){if(e={...e},this.bearerToken)e.Authorization="Bearer "+this.bearerToken;else if(this.basicToken)e.Authorization="Basic "+this.basicToken;else if(this.clientId&&this.clientSecret)e.Authorization="Basic "+Z.getAuthHeader(this.clientId,this.clientSecret);else if(this.consumerSecret&&this._oauth){let n=t?Y.mergeQueryAndBodyForOAuth(i,a):i,o=this._oauth.authorize({url:s.toString(),method:r,data:n},this.getOAuthAccessTokens());e={...e,...this._oauth.toHeader(o)}}return e}getUrlObjectFromUrlString(e){return e.startsWith("http")||(e="https://"+e),new URL(e)}getHttpRequestArgs({url:e,method:t,query:s={},body:r={},headers:i,forceBodyMode:a,enableAuth:n,params:o}){let l;t=t.toUpperCase(),(i=null!=i?i:{})["x-user-agent"]||(i["x-user-agent"]="Node.twitter-api-v2");let u=this.getUrlObjectFromUrlString(e),c=u.origin+u.pathname;o&&Y.applyRequestParametersToUrl(u,o);let d=Y.formatQueryToString(s);Y.moveUrlQueryParamsIntoObject(u,d),r instanceof Buffer||function(e){for(let t in e)void 0===e[t]&&delete e[t]}(r);let h=null!=a?a:Y.autoDetectBodyType(u);if(!1!==n){let e=X.BODY_METHODS.has(t)&&"url"===h;i=this.writeAuthHeaders({headers:i,bodyInSignature:e,method:t,query:d,url:u,body:r})}return X.BODY_METHODS.has(t)&&(l=Y.constructBodyParams(r,i,h)||void 0),Y.addQueryParamsToUrl(u,d),{rawUrl:c,url:u,method:t,headers:i,body:l}}async applyPreRequestConfigHooks(e){var t;let s=this.getUrlObjectFromUrlString(e.url);for(let r of this.getPlugins()){let i=await (null===(t=r.onBeforeRequestConfig)||void 0===t?void 0:t.call(r,{client:this,url:s,params:e}));if(i)return i}}applyPreStreamRequestConfigHooks(e){var t;let s=this.getUrlObjectFromUrlString(e.url);for(let r of this.getPlugins())null===(t=r.onBeforeStreamRequestConfig)||void 0===t||t.call(r,{client:this,url:s,params:e})}async applyPreRequestHooks(e,t,s){await this.applyPluginMethod("onBeforeRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s})}async applyPostRequestHooks(e,t,s,r){return await this.applyPluginMethod("onAfterRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s,response:r})}applyResponseErrorHooks(e,t,s,r){return r.catch(W.bind(this,e,t,s))}}X.BODY_METHODS=new Set(["POST","PUT","PATCH"]);class ee{constructor(e,t={}){this._currentUser=null,this._currentUserV2=null,e instanceof ee?this._requestMaker=e._requestMaker:(this._requestMaker=new X(t),this._requestMaker.initializeToken(e))}setPrefix(e){this._prefix=e}cloneWithPrefix(e){let t=this.constructor(this);return t.setPrefix(e),t}getActiveTokens(){return this._requestMaker.getActiveTokens()}getPlugins(){return this._requestMaker.getPlugins()}getPluginOfType(e){return this.getPlugins().find(t=>t instanceof e)}hasHitRateLimit(e){var t;return!this.isRateLimitStatusObsolete(e)&&(null===(t=this.getLastRateLimitStatus(e))||void 0===t?void 0:t.remaining)===0}isRateLimitStatusObsolete(e){let t=this.getLastRateLimitStatus(e);return void 0===t||1e3*t.reset<Date.now()}getLastRateLimitStatus(e){let t=e.match(/^https?:\/\//)?e:this._prefix+e;return this._requestMaker.getRateLimits()[t]}getCurrentUserObject(e=!1){return!e&&this._currentUser?this._currentUser.value?Promise.resolve(this._currentUser.value):this._currentUser.promise:(this._currentUser=q(()=>this.get("account/verify_credentials.json",{tweet_mode:"extended"},{prefix:a})),this._currentUser.promise)}getCurrentUserV2Object(e=!1){return!e&&this._currentUserV2?this._currentUserV2.value?Promise.resolve(this._currentUserV2.value):this._currentUserV2.promise:(this._currentUserV2=q(()=>this.get("users/me",void 0,{prefix:r})),this._currentUserV2.promise)}async get(e,t={},{fullResponse:s,prefix:r=this._prefix,...i}={}){r&&(e=r+e);let a=await this._requestMaker.send({url:e,method:"GET",query:t,...i});return s?a:a.data}async delete(e,t={},{fullResponse:s,prefix:r=this._prefix,...i}={}){r&&(e=r+e);let a=await this._requestMaker.send({url:e,method:"DELETE",query:t,...i});return s?a:a.data}async post(e,t,{fullResponse:s,prefix:r=this._prefix,...i}={}){r&&(e=r+e);let a=await this._requestMaker.send({url:e,method:"POST",body:t,...i});return s?a:a.data}async put(e,t,{fullResponse:s,prefix:r=this._prefix,...i}={}){r&&(e=r+e);let a=await this._requestMaker.send({url:e,method:"PUT",body:t,...i});return s?a:a.data}async patch(e,t,{fullResponse:s,prefix:r=this._prefix,...i}={}){r&&(e=r+e);let a=await this._requestMaker.send({url:e,method:"PATCH",body:t,...i});return s?a:a.data}getStream(e,t,{prefix:s=this._prefix,...r}={}){return this._requestMaker.sendStream({url:s?s+e:e,method:"GET",query:t,...r})}postStream(e,t,{prefix:s=this._prefix,...r}={}){return this._requestMaker.sendStream({url:s?s+e:e,method:"POST",body:t,...r})}}class et extends ee{constructor(e){if(!(e instanceof ee))throw Error("You must instance SubTwitterApi instance from existing TwitterApi instance.");super(e)}}class es extends d{constructor(){super(...arguments),this.hasFinishedFetch=!1}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.push(...s),this.hasFinishedFetch=0===s.length)}getNextQueryParams(e){let t=BigInt(this._realData[this._realData.length-1].id_str);return{...this.injectQueryParams(e),max_id:(t-BigInt(1)).toString()}}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.tweets}get tweets(){return this._realData}get done(){return super.done||this.hasFinishedFetch}}class er extends es{constructor(){super(...arguments),this._endpoint="statuses/home_timeline.json"}}class ei extends es{constructor(){super(...arguments),this._endpoint="statuses/mentions_timeline.json"}}class ea extends es{constructor(){super(...arguments),this._endpoint="statuses/user_timeline.json"}}class en extends es{constructor(){super(...arguments),this._endpoint="lists/statuses.json"}}class eo extends es{constructor(){super(...arguments),this._endpoint="favorites/list.json"}}class el extends h{constructor(){super(...arguments),this._endpoint="mutes/users/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}}class eu extends h{constructor(){super(...arguments),this._endpoint="mutes/users/ids.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}}class ec extends h{constructor(){super(...arguments),this._endpoint="followers/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}}class ed extends h{constructor(){super(...arguments),this._endpoint="followers/ids.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}}class eh extends h{constructor(){super(...arguments),this._endpoint="friends/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}}class ep extends h{constructor(){super(...arguments),this._endpoint="friends/ids.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}}class em extends d{constructor(){super(...arguments),this._endpoint="users/search.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&this._realData.push(...s)}getNextQueryParams(e){var t;let s=Number(null!==(t=this._queryParams.page)&&void 0!==t?t:"1");return{...this._queryParams,page:s+1,...e?{count:e}:{}}}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.users}get users(){return this._realData}}class eg extends h{constructor(){super(...arguments),this._endpoint="friendships/incoming.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}}class ef extends eg{constructor(){super(...arguments),this._endpoint="friendships/outgoing.json"}}class e_ extends h{refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.lists.push(...s.lists),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.lists.length}getItemArray(){return this.lists}get lists(){return this._realData.lists}}class ey extends e_{constructor(){super(...arguments),this._endpoint="lists/memberships.json"}}class ew extends e_{constructor(){super(...arguments),this._endpoint="lists/ownerships.json"}}class ev extends e_{constructor(){super(...arguments),this._endpoint="lists/subscriptions.json"}}class eb extends h{refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}}class eR extends eb{constructor(){super(...arguments),this._endpoint="lists/members.json"}}class ex extends eb{constructor(){super(...arguments),this._endpoint="lists/subscribers.json"}}class ek extends et{constructor(){super(...arguments),this._prefix=a}singleTweet(e,t={}){return this.get("statuses/show.json",{tweet_mode:"extended",id:e,...t})}tweets(e,t={}){return this.post("statuses/lookup.json",{tweet_mode:"extended",id:e,...t})}oembedTweet(e,t={}){return this.get("oembed",{url:`https://x.com/i/statuses/${e}`,...t},{prefix:"https://publish.x.com/"})}async homeTimeline(e={}){let t={tweet_mode:"extended",...e},s=await this.get("statuses/home_timeline.json",t,{fullResponse:!0});return new er({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async mentionTimeline(e={}){let t={tweet_mode:"extended",...e},s=await this.get("statuses/mentions_timeline.json",t,{fullResponse:!0});return new ei({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userTimeline(e,t={}){let s={tweet_mode:"extended",user_id:e,...t},r=await this.get("statuses/user_timeline.json",s,{fullResponse:!0});return new ea({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}async userTimelineByUsername(e,t={}){let s={tweet_mode:"extended",screen_name:e,...t},r=await this.get("statuses/user_timeline.json",s,{fullResponse:!0});return new ea({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}async favoriteTimeline(e,t={}){let s={tweet_mode:"extended",user_id:e,...t},r=await this.get("favorites/list.json",s,{fullResponse:!0});return new eo({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}async favoriteTimelineByUsername(e,t={}){let s={tweet_mode:"extended",screen_name:e,...t},r=await this.get("favorites/list.json",s,{fullResponse:!0});return new eo({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}user(e){return this.get("users/show.json",{tweet_mode:"extended",...e})}users(e){return this.get("users/lookup.json",{tweet_mode:"extended",...e})}verifyCredentials(e={}){return this.get("account/verify_credentials.json",e)}async listMutedUsers(e={}){let t={tweet_mode:"extended",...e},s=await this.get("mutes/users/list.json",t,{fullResponse:!0});return new el({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listMutedUserIds(e={}){let t={stringify_ids:!0,...e},s=await this.get("mutes/users/ids.json",t,{fullResponse:!0});return new eu({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userFriendList(e={}){let t={...e},s=await this.get("friends/list.json",t,{fullResponse:!0});return new eh({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userFollowerList(e={}){let t={...e},s=await this.get("followers/list.json",t,{fullResponse:!0});return new ec({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userFollowerIds(e={}){let t={stringify_ids:!0,...e},s=await this.get("followers/ids.json",t,{fullResponse:!0});return new ed({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userFollowingIds(e={}){let t={stringify_ids:!0,...e},s=await this.get("friends/ids.json",t,{fullResponse:!0});return new ep({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async searchUsers(e,t={}){let s={q:e,tweet_mode:"extended",page:1,...t},r=await this.get("users/search.json",s,{fullResponse:!0});return new em({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}friendship(e){return this.get("friendships/show.json",e)}friendships(e){return this.get("friendships/lookup.json",e)}friendshipsNoRetweets(){return this.get("friendships/no_retweets/ids.json",{stringify_ids:!0})}async friendshipsIncoming(e={}){let t={stringify_ids:!0,...e},s=await this.get("friendships/incoming.json",t,{fullResponse:!0});return new eg({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async friendshipsOutgoing(e={}){let t={stringify_ids:!0,...e},s=await this.get("friendships/outgoing.json",t,{fullResponse:!0});return new ef({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}accountSettings(){return this.get("account/settings.json")}userProfileBannerSizes(e){return this.get("users/profile_banner.json",e)}list(e){return this.get("lists/show.json",{tweet_mode:"extended",...e})}lists(e={}){return this.get("lists/list.json",{tweet_mode:"extended",...e})}async listMembers(e={}){let t={tweet_mode:"extended",...e},s=await this.get("lists/members.json",t,{fullResponse:!0});return new eR({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}listGetMember(e){return this.get("lists/members/show.json",{tweet_mode:"extended",...e})}async listMemberships(e={}){let t={tweet_mode:"extended",...e},s=await this.get("lists/memberships.json",t,{fullResponse:!0});return new ey({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listOwnerships(e={}){let t={tweet_mode:"extended",...e},s=await this.get("lists/ownerships.json",t,{fullResponse:!0});return new ew({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listStatuses(e){let t={tweet_mode:"extended",...e},s=await this.get("lists/statuses.json",t,{fullResponse:!0});return new en({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listSubscribers(e={}){let t={tweet_mode:"extended",...e},s=await this.get("lists/subscribers.json",t,{fullResponse:!0});return new ex({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}listGetSubscriber(e){return this.get("lists/subscribers/show.json",{tweet_mode:"extended",...e})}async listSubscriptions(e={}){let t={tweet_mode:"extended",...e},s=await this.get("lists/subscriptions.json",t,{fullResponse:!0});return new ev({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}mediaInfo(e){return this.get("media/upload.json",{command:"STATUS",media_id:e},{prefix:n})}filterStream({autoConnect:e,...t}={}){let s={};for(let[e,r]of Object.entries(t))"follow"===e||"track"===e?s[e]=r.toString():"locations"===e?s.locations=L(r).map(e=>`${e.lng},${e.lat}`).join(","):s[e]=r;return this.stream.postStream("statuses/filter.json",s,{autoConnect:e})}sampleStream({autoConnect:e,...t}={}){return this.stream.getStream("statuses/sample.json",t,{autoConnect:e})}get stream(){let e=new eI(this);return e.setPrefix("https://stream.x.com/1.1/"),e}trendsByPlace(e,t={}){return this.get("trends/place.json",{id:e,...t})}trendsAvailable(){return this.get("trends/available.json")}trendsClosest(e,t){return this.get("trends/closest.json",{lat:e,long:t})}geoPlace(e){return this.get("geo/id/:place_id.json",void 0,{params:{place_id:e}})}geoSearch(e){return this.get("geo/search.json",e)}geoReverseGeoCode(e){return this.get("geo/reverse_geocode.json",e)}rateLimitStatuses(...e){return this.get("application/rate_limit_status.json",{resources:e})}supportedLanguages(){return this.get("help/languages.json")}}async function eS(e){let t=await eT(e);return"number"==typeof t?new Promise((e,s)=>{D.readFile(t,(t,r)=>{if(t)return s(t);e(r)})}):t instanceof Buffer?t:t.readFile()}function eT(e){if("string"==typeof e)return D.promises.open(e,"r");if("number"==typeof e||"object"==typeof e&&!(e instanceof Buffer)||e instanceof Buffer)return e;throw Error("Given file is not valid, please check its type.")}async function eD(e){return"number"==typeof e?(await new Promise((t,s)=>{D.fstat(e,(e,r)=>{e&&s(e),t(r)})})).size:e instanceof Buffer?e.length:(await e.stat()).size}function eE(e){return new Promise(t=>setTimeout(t,1e3*e))}async function eq(e,t,s=0,r){let i;if(e instanceof Buffer){let r=e.slice(s,s+t);return[r,r.length]}if(!r)throw Error("Well, we will need a buffer to store file content.");return i="number"==typeof e?await new Promise((i,a)=>{D.read(e,r,0,t,s,(e,t)=>{e&&a(e),i(t)})}):(await e.read(r,0,t,s)).bytesRead,[r,i]}let eL="media/upload.json";class eA extends ek{constructor(){super(...arguments),this._prefix=a}get readOnly(){return this}tweet(e,t={}){let s={status:e,tweet_mode:"extended",...t};return this.post("statuses/update.json",s)}async quote(e,t,s={}){return this.tweet(e,{...s,attachment_url:"https://x.com/i/statuses/"+t})}async tweetThread(e){let t=[];for(let s of e){let e=t.length?t[t.length-1]:null,r={..."string"==typeof s?{status:s}:s},i=e?e.id_str:r.in_reply_to_status_id,a=r.status;i?t.push(await this.reply(a,i,r)):t.push(await this.tweet(a,r))}return t}reply(e,t,s={}){return this.tweet(e,{auto_populate_reply_metadata:!0,in_reply_to_status_id:t,...s})}deleteTweet(e){return this.post("statuses/destroy/:id.json",{tweet_mode:"extended"},{params:{id:e}})}reportUserAsSpam(e){return this.post("users/report_spam.json",{tweet_mode:"extended",...e})}updateFriendship(e){return this.post("friendships/update.json",e)}createFriendship(e){return this.post("friendships/create.json",e)}destroyFriendship(e){return this.post("friendships/destroy.json",e)}updateAccountSettings(e){return this.post("account/settings.json",e)}updateAccountProfile(e){return this.post("account/update_profile.json",e)}async updateAccountProfileBanner(e,t={}){let s={banner:await eS(e),...t};return this.post("account/update_profile_banner.json",s,{forceBodyMode:"form-data"})}async updateAccountProfileImage(e,t={}){let s={tweet_mode:"extended",image:await eS(e),...t};return this.post("account/update_profile_image.json",s,{forceBodyMode:"form-data"})}removeAccountProfileBanner(){return this.post("account/remove_profile_banner.json")}createList(e){return this.post("lists/create.json",{tweet_mode:"extended",...e})}updateList(e){return this.post("lists/update.json",{tweet_mode:"extended",...e})}removeList(e){return this.post("lists/destroy.json",{tweet_mode:"extended",...e})}addListMembers(e){let t=e.user_id&&P(e.user_id)||e.screen_name&&P(e.screen_name);return this.post(t?"lists/members/create_all.json":"lists/members/create.json",e)}removeListMembers(e){let t=e.user_id&&P(e.user_id)||e.screen_name&&P(e.screen_name);return this.post(t?"lists/members/destroy_all.json":"lists/members/destroy.json",e)}subscribeToList(e){return this.post("lists/subscribers/create.json",{tweet_mode:"extended",...e})}unsubscribeOfList(e){return this.post("lists/subscribers/destroy.json",{tweet_mode:"extended",...e})}createMediaMetadata(e,t){return this.post("media/metadata/create.json",{media_id:e,...t},{prefix:n,forceBodyMode:"json"})}createMediaSubtitles(e,t){return this.post("media/subtitles/create.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t}},{prefix:n,forceBodyMode:"json"})}deleteMediaSubtitles(e,...t){return this.post("media/subtitles/delete.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t.map(e=>({language_code:e}))}},{prefix:n,forceBodyMode:"json"})}async uploadMedia(e,t={},s=!1){var r;let i=null!==(r=t.chunkLength)&&void 0!==r?r:1048576,{fileHandle:a,mediaCategory:o,fileSize:l,mimeType:u}=await this.getUploadMediaRequirements(e,t);try{let e=await this.post(eL,{command:"INIT",total_bytes:l,media_type:u,media_category:o,additional_owners:t.additionalOwners,shared:!!t.shared||void 0},{prefix:n});await this.mediaChunkedUpload(a,i,e.media_id_string,t.maxConcurrentUploads);let r=await this.post(eL,{command:"FINALIZE",media_id:e.media_id_string},{prefix:n});if(r.processing_info&&"succeeded"!==r.processing_info.state&&await this.awaitForMediaProcessingCompletion(r),s)return r;return r.media_id_string}finally{"number"==typeof e?D.close(e,()=>{}):"object"!=typeof a||a instanceof Buffer||a.close()}}async awaitForMediaProcessingCompletion(e){for(var t;;){let{processing_info:s}=e=await this.mediaInfo(e.media_id_string);if(!s||"succeeded"===s.state)return;if(null===(t=s.error)||void 0===t?void 0:t.code){let{name:e,message:t}=s.error;throw Error(`Failed to process media: ${e} - ${t}.`)}if("failed"===s.state)throw Error("Failed to process the media.");s.check_after_secs?await eE(s.check_after_secs):await eE(5)}}async getUploadMediaRequirements(e,{mimeType:t,type:s,target:r,longVideo:i}={}){let a;try{let o;a=await eT(e);let l=function(e,t,s){if("string"==typeof s)return s;if("string"==typeof e&&!t)return e.endsWith(".jpeg")||e.endsWith(".jpg")?v.Jpeg:e.endsWith(".png")?v.Png:e.endsWith(".webp")?v.Webp:e.endsWith(".gif")?v.Gif:e.endsWith(".mpeg4")||e.endsWith(".mp4")?v.Mp4:e.endsWith(".mov")||e.endsWith(".mov")?v.Mov:e.endsWith(".srt")?v.Srt:(j({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"options.mimeType is missing and filename couldn't help to resolve MIME type, so it will fallback to image/jpeg",resolution:"If you except to give filenames without extensions, please specify explicitlty the MIME type using options.mimeType"}),v.Jpeg);if("string"==typeof t)return(j({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"you're using options.type",resolution:"Remove options.type argument and migrate to options.mimeType which takes the real MIME type. If you're using type=longmp4, add options.longVideo alongside of mimeType=EUploadMimeType.Mp4"}),"gif"===t)?v.Gif:"jpg"===t?v.Jpeg:"png"===t?v.Png:"webp"===t?v.Webp:"srt"===t?v.Srt:"mp4"===t||"longmp4"===t?v.Mp4:"mov"===t?v.Mov:t;throw Error("You must specify type if file is a file handle or Buffer.")}(e,s,t);if(l!==v.Mp4||(t||s||"dm"===r)&&!i){var n;n=null!=r?r:"tweet",o=l===v.Mp4||l===v.Mov?"tweet"===n?"TweetVideo":"DmVideo":l===v.Gif?"tweet"===n?"TweetGif":"DmGif":l===v.Srt?"Subtitles":"tweet"===n?"TweetImage":"DmImage"}else o="amplify_video";return{fileHandle:a,mediaCategory:o,fileSize:await eD(a),mimeType:l}}catch(t){throw"number"==typeof e?D.close(e,()=>{}):"object"!=typeof a||a instanceof Buffer||a.close(),t}}async mediaChunkedUpload(e,t,s,r=3){let i,a,o=0;if(r<1)throw RangeError("Bad maxConcurrentUploads parameter.");let l=e instanceof Buffer?void 0:Buffer.alloc(t),u=0;[i,a]=await eq(e,t,u,l),u+=a;let c=new Set;for(;a;){let d=i.slice(0,a);if(d.length){let e=this.post(eL,{command:"APPEND",media_id:s,segment_index:o,media:d},{prefix:n});c.add(e),e.then(()=>{c.delete(e)}),o++}c.size>=r&&await Promise.race(c),[i,a]=await eq(e,t,u,l),u+=a}await Promise.all([...c])}}class eP extends eA{constructor(){super(...arguments),this._prefix=a}get readWrite(){return this}sendDm({recipient_id:e,custom_profile_id:t,...s}){let r={event:{type:b.Create,[b.Create]:{target:{recipient_id:e},message_data:s}}};return t&&(r.event[b.Create].custom_profile_id=t),this.post("direct_messages/events/new.json",r,{forceBodyMode:"json"})}getDmEvent(e){return this.get("direct_messages/events/show.json",{id:e})}deleteDm(e){return this.delete("direct_messages/events/destroy.json",{id:e})}async listDmEvents(e={}){let t={...e},s=await this.get("direct_messages/events/list.json",t,{fullResponse:!0});return new p({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}newWelcomeDm(e,t){let s={[b.WelcomeCreate]:{name:e,message_data:t}};return this.post("direct_messages/welcome_messages/new.json",s,{forceBodyMode:"json"})}getWelcomeDm(e){return this.get("direct_messages/welcome_messages/show.json",{id:e})}deleteWelcomeDm(e){return this.delete("direct_messages/welcome_messages/destroy.json",{id:e})}updateWelcomeDm(e,t){return this.put("direct_messages/welcome_messages/update.json",{message_data:t},{forceBodyMode:"json",query:{id:e}})}async listWelcomeDms(e={}){let t={...e},s=await this.get("direct_messages/welcome_messages/list.json",t,{fullResponse:!0});return new m({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}newWelcomeDmRule(e){return this.post("direct_messages/welcome_messages/rules/new.json",{welcome_message_rule:{welcome_message_id:e}},{forceBodyMode:"json"})}getWelcomeDmRule(e){return this.get("direct_messages/welcome_messages/rules/show.json",{id:e})}deleteWelcomeDmRule(e){return this.delete("direct_messages/welcome_messages/rules/destroy.json",{id:e})}async listWelcomeDmRules(e={}){let t={...e};return this.get("direct_messages/welcome_messages/rules/list.json",t)}async setWelcomeDm(e,t=!0){var s;let r=await this.listWelcomeDmRules();if(null===(s=r.welcome_message_rules)||void 0===s?void 0:s.length)for(let e of r.welcome_message_rules)await this.deleteWelcomeDmRule(e.id),t&&await this.deleteWelcomeDm(e.welcome_message_id);return this.newWelcomeDmRule(e)}markDmAsRead(e,t){return this.post("direct_messages/mark_read.json",{last_read_event_id:e,recipient_id:t},{forceBodyMode:"url"})}indicateDmTyping(e){return this.post("direct_messages/indicate_typing.json",{recipient_id:e},{forceBodyMode:"url"})}async downloadDmImage(e){if("string"!=typeof e){let t=e[b.Create].message_data.attachment;if(!t)throw Error("The given direct message doesn't contain any attachment");e=t.media.media_url_https}let t=await this.get(e,void 0,{forceParseMode:"buffer",prefix:""});if(!t.length)throw Error("Image not found. Make sure you are logged with credentials able to access direct messages, and check the URL.");return t}}let eI=eP;class ej{constructor(e){this.result=e}get tweets(){return ej.tweets(this.result)}static tweets(e){var t,s;return null!==(s=null===(t=e.includes)||void 0===t?void 0:t.tweets)&&void 0!==s?s:[]}tweetById(e){return ej.tweetById(this.result,e)}static tweetById(e,t){return this.tweets(e).find(e=>e.id===t)}retweet(e){return ej.retweet(this.result,e)}static retweet(e,t){var s;let r=(null!==(s=t.referenced_tweets)&&void 0!==s?s:[]).filter(e=>"retweeted"===e.type).map(e=>e.id);return this.tweets(e).find(e=>r.includes(e.id))}quote(e){return ej.quote(this.result,e)}static quote(e,t){var s;let r=(null!==(s=t.referenced_tweets)&&void 0!==s?s:[]).filter(e=>"quoted"===e.type).map(e=>e.id);return this.tweets(e).find(e=>r.includes(e.id))}repliedTo(e){return ej.repliedTo(this.result,e)}static repliedTo(e,t){var s;let r=(null!==(s=t.referenced_tweets)&&void 0!==s?s:[]).filter(e=>"replied_to"===e.type).map(e=>e.id);return this.tweets(e).find(e=>r.includes(e.id))}author(e){return ej.author(this.result,e)}static author(e,t){let s=t.author_id;return s?this.users(e).find(e=>e.id===s):void 0}repliedToAuthor(e){return ej.repliedToAuthor(this.result,e)}static repliedToAuthor(e,t){let s=t.in_reply_to_user_id;return s?this.users(e).find(e=>e.id===s):void 0}get users(){return ej.users(this.result)}static users(e){var t,s;return null!==(s=null===(t=e.includes)||void 0===t?void 0:t.users)&&void 0!==s?s:[]}userById(e){return ej.userById(this.result,e)}static userById(e,t){return this.users(e).find(e=>e.id===t)}pinnedTweet(e){return ej.pinnedTweet(this.result,e)}static pinnedTweet(e,t){return t.pinned_tweet_id?this.tweets(e).find(e=>e.id===t.pinned_tweet_id):void 0}get media(){return ej.media(this.result)}static media(e){var t,s;return null!==(s=null===(t=e.includes)||void 0===t?void 0:t.media)&&void 0!==s?s:[]}medias(e){return ej.medias(this.result,e)}static medias(e,t){var s,r;let i=null!==(r=null===(s=t.attachments)||void 0===s?void 0:s.media_keys)&&void 0!==r?r:[];return this.media(e).filter(e=>i.includes(e.media_key))}get polls(){return ej.polls(this.result)}static polls(e){var t,s;return null!==(s=null===(t=e.includes)||void 0===t?void 0:t.polls)&&void 0!==s?s:[]}poll(e){return ej.poll(this.result,e)}static poll(e,t){var s,r;let i=null!==(r=null===(s=t.attachments)||void 0===s?void 0:s.poll_ids)&&void 0!==r?r:[];if(i.length){let t=i[0];return this.polls(e).find(e=>e.id===t)}}get places(){return ej.places(this.result)}static places(e){var t,s;return null!==(s=null===(t=e.includes)||void 0===t?void 0:t.places)&&void 0!==s?s:[]}place(e){return ej.place(this.result,e)}static place(e,t){var s;let r=null===(s=t.geo)||void 0===s?void 0:s.place_id;return r?this.places(e).find(e=>e.id===r):void 0}listOwner(e){return ej.listOwner(this.result,e)}static listOwner(e,t){let s=t.owner_id;return s?this.users(e).find(e=>e.id===s):void 0}spaceCreator(e){return ej.spaceCreator(this.result,e)}static spaceCreator(e,t){let s=t.creator_id;return s?this.users(e).find(e=>e.id===s):void 0}spaceHosts(e){return ej.spaceHosts(this.result,e)}static spaceHosts(e,t){var s;let r=null!==(s=t.host_ids)&&void 0!==s?s:[];return this.users(e).filter(e=>r.includes(e.id))}spaceSpeakers(e){return ej.spaceSpeakers(this.result,e)}static spaceSpeakers(e,t){var s;let r=null!==(s=t.speaker_ids)&&void 0!==s?s:[];return this.users(e).filter(e=>r.includes(e.id))}spaceInvitedUsers(e){return ej.spaceInvitedUsers(this.result,e)}static spaceInvitedUsers(e,t){var s;let r=null!==(s=t.invited_user_ids)&&void 0!==s?s:[];return this.users(e).filter(e=>r.includes(e.id))}}class eM extends c{updateIncludes(e){if(e.errors&&(this._realData.errors||(this._realData.errors=[]),this._realData.errors=[...this._realData.errors,...e.errors]),!e.includes)return;this._realData.includes||(this._realData.includes={});let t=this._realData.includes;for(let[s,r]of Object.entries(e.includes))t[s]||(t[s]=[]),t[s]=[...t[s],...r]}assertUsable(){if(this.unusable)throw Error("Unable to use this paginator to fetch more data, as it does not contain any metadata. Check .errors property for more details.")}get meta(){return this._realData.meta}get includes(){var e;return(null===(e=this._realData)||void 0===e?void 0:e.includes)?this._includesInstance?this._includesInstance:this._includesInstance=new ej(this._realData):new ej(this._realData)}get errors(){var e;return null!==(e=this._realData.errors)&&void 0!==e?e:[]}get unusable(){return this.errors.length>0&&!this._realData.meta&&!this._realData.data}}class eC extends eM{refreshInstanceFromResult(e,t){var s;let r=e.data,i=null!==(s=r.data)&&void 0!==s?s:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.result_count+=r.meta.result_count,this._realData.meta.next_token=r.meta.next_token,this._realData.data.push(...i)):(this._realData.meta.result_count+=r.meta.result_count,this._realData.meta.previous_token=r.meta.previous_token,this._realData.data.unshift(...i)),this.updateIncludes(r)}getNextQueryParams(e){return this.assertUsable(),{...this.injectQueryParams(e),pagination_token:this._realData.meta.next_token}}getPreviousQueryParams(e){return this.assertUsable(),{...this.injectQueryParams(e),pagination_token:this._realData.meta.previous_token}}getPageLengthFromRequest(e){var t,s;return null!==(s=null===(t=e.data.data)||void 0===t?void 0:t.length)&&void 0!==s?s:0}isFetchLastOver(e){var t;return!(null===(t=e.data.data)||void 0===t?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){var t;return!!(null===(t=e.meta)||void 0===t?void 0:t.next_token)}}class eF extends eM{refreshInstanceFromResult(e,t){var s;let r=e.data,i=null!==(s=r.data)&&void 0!==s?s:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.oldest_id=r.meta.oldest_id,this._realData.meta.result_count+=r.meta.result_count,this._realData.meta.next_token=r.meta.next_token,this._realData.data.push(...i)):(this._realData.meta.newest_id=r.meta.newest_id,this._realData.meta.result_count+=r.meta.result_count,this._realData.data.unshift(...i)),this.updateIncludes(r)}getNextQueryParams(e){this.assertUsable();let t={...this.injectQueryParams(e)};return this._realData.meta.next_token?t.next_token=this._realData.meta.next_token:(t.start_time&&(t.since_id=this.dateStringToSnowflakeId(t.start_time),delete t.start_time),t.end_time&&delete t.end_time,t.until_id=this._realData.meta.oldest_id),t}getPreviousQueryParams(e){return this.assertUsable(),{...this.injectQueryParams(e),since_id:this._realData.meta.newest_id}}getPageLengthFromRequest(e){var t,s;return null!==(s=null===(t=e.data.data)||void 0===t?void 0:t.length)&&void 0!==s?s:0}isFetchLastOver(e){var t;return!(null===(t=e.data.data)||void 0===t?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!!e.meta.next_token}getItemArray(){return this.tweets}dateStringToSnowflakeId(e){let t=BigInt("1288834974657"),s=new Date(e);if(isNaN(s.valueOf()))throw Error("Unable to convert start_time/end_time to a valid date. A ISO 8601 DateTime is excepted, please check your input.");return(BigInt(s.valueOf())-t<<BigInt("22")).toString()}get tweets(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}}class eO extends eC{refreshInstanceFromResult(e,t){super.refreshInstanceFromResult(e,t);let s=e.data;t?this._realData.meta.oldest_id=s.meta.oldest_id:this._realData.meta.newest_id=s.meta.newest_id}getItemArray(){return this.tweets}get tweets(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}}class eN extends eF{constructor(){super(...arguments),this._endpoint="tweets/search/recent"}}class eU extends eF{constructor(){super(...arguments),this._endpoint="tweets/search/all"}}class eB extends eO{constructor(){super(...arguments),this._endpoint="tweets/:id/quote_tweets"}}class ez extends eO{constructor(){super(...arguments),this._endpoint="users/:id/timelines/reverse_chronological"}}class eH extends eO{constructor(){super(...arguments),this._endpoint="users/:id/tweets"}}class e$ extends eO{constructor(){super(...arguments),this._endpoint="users/:id/mentions"}}class eW extends eO{constructor(){super(...arguments),this._endpoint="users/:id/bookmarks"}}class eV extends eC{get tweets(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}getItemArray(){return this.tweets}}class eK extends eV{constructor(){super(...arguments),this._endpoint="users/:id/liked_tweets"}}class eJ extends eV{constructor(){super(...arguments),this._endpoint="lists/:id/tweets"}}class eQ extends eC{getItemArray(){return this.users}get users(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}}class eG extends eQ{constructor(){super(...arguments),this._endpoint="users/:id/blocking"}}class eY extends eQ{constructor(){super(...arguments),this._endpoint="users/:id/muting"}}class eZ extends eQ{constructor(){super(...arguments),this._endpoint="users/:id/followers"}}class eX extends eQ{constructor(){super(...arguments),this._endpoint="users/:id/following"}}class e0 extends eQ{constructor(){super(...arguments),this._endpoint="lists/:id/members"}}class e1 extends eQ{constructor(){super(...arguments),this._endpoint="lists/:id/followers"}}class e2 extends eQ{constructor(){super(...arguments),this._endpoint="tweets/:id/liking_users"}}class e4 extends eQ{constructor(){super(...arguments),this._endpoint="tweets/:id/retweeted_by"}}class e3 extends eC{getItemArray(){return this.lists}get lists(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}}class e6 extends e3{constructor(){super(...arguments),this._endpoint="users/:id/owned_lists"}}class e5 extends e3{constructor(){super(...arguments),this._endpoint="users/:id/list_memberships"}}class e8 extends e3{constructor(){super(...arguments),this._endpoint="users/:id/followed_lists"}}class e9 extends et{constructor(){super(...arguments),this._prefix=i}}class e7 extends eC{getItemArray(){return this.events}get events(){var e;return null!==(e=this._realData.data)&&void 0!==e?e:[]}get meta(){return super.meta}}class te extends e7{constructor(){super(...arguments),this._endpoint="dm_events"}}class tt extends e7{constructor(){super(...arguments),this._endpoint="dm_conversations/with/:participant_id/dm_events"}}class ts extends e7{constructor(){super(...arguments),this._endpoint="dm_conversations/:dm_conversation_id/dm_events"}}class tr extends et{constructor(){super(...arguments),this._prefix=r}get labs(){return this._labs?this._labs:this._labs=new e9(this)}async search(e,t={}){let s="string"==typeof e?{...t,query:e}:{...e},r=await this.get("tweets/search/recent",s,{fullResponse:!0});return new eN({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}async searchAll(e,t={}){let s={...t,query:e},r=await this.get("tweets/search/all",s,{fullResponse:!0});return new eU({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:s})}singleTweet(e,t={}){return this.get("tweets/:id",t,{params:{id:e}})}tweets(e,t={}){return this.get("tweets",{ids:e,...t})}tweetCountRecent(e,t={}){return this.get("tweets/counts/recent",{query:e,...t})}tweetCountAll(e,t={}){return this.get("tweets/counts/all",{query:e,...t})}async tweetRetweetedBy(e,t={}){let{asPaginator:s,...r}=t,i=await this.get("tweets/:id/retweeted_by",r,{fullResponse:!0,params:{id:e}});return s?new e4({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:r,sharedParams:{id:e}}):i.data}async tweetLikedBy(e,t={}){let{asPaginator:s,...r}=t,i=await this.get("tweets/:id/liking_users",r,{fullResponse:!0,params:{id:e}});return s?new e2({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:r,sharedParams:{id:e}}):i.data}async homeTimeline(e={}){let t=await this.getCurrentUserV2Object(),s=await this.get("users/:id/timelines/reverse_chronological",e,{fullResponse:!0,params:{id:t.data.id}});return new ez({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}async userTimeline(e,t={}){let s=await this.get("users/:id/tweets",t,{fullResponse:!0,params:{id:e}});return new eH({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async userMentionTimeline(e,t={}){let s=await this.get("users/:id/mentions",t,{fullResponse:!0,params:{id:e}});return new e$({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async quotes(e,t={}){let s=await this.get("tweets/:id/quote_tweets",t,{fullResponse:!0,params:{id:e}});return new eB({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async bookmarks(e={}){let t=await this.getCurrentUserV2Object(),s=await this.get("users/:id/bookmarks",e,{fullResponse:!0,params:{id:t.data.id}});return new eW({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}me(e={}){return this.get("users/me",e)}user(e,t={}){return this.get("users/:id",t,{params:{id:e}})}users(e,t={}){let s=Array.isArray(e)?e.join(","):e;return this.get("users",{...t,ids:s})}userByUsername(e,t={}){return this.get("users/by/username/:username",t,{params:{username:e}})}usersByUsernames(e,t={}){return e=Array.isArray(e)?e.join(","):e,this.get("users/by",{...t,usernames:e})}async followers(e,t={}){let{asPaginator:s,...r}=t,i={id:e};if(!s)return this.get("users/:id/followers",r,{params:i});let a=await this.get("users/:id/followers",r,{fullResponse:!0,params:i});return new eZ({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:r,sharedParams:i})}async following(e,t={}){let{asPaginator:s,...r}=t,i={id:e};if(!s)return this.get("users/:id/following",r,{params:i});let a=await this.get("users/:id/following",r,{fullResponse:!0,params:i});return new eX({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:r,sharedParams:i})}async userLikedTweets(e,t={}){let s={id:e},r=await this.get("users/:id/liked_tweets",t,{fullResponse:!0,params:s});return new eK({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async userBlockingUsers(e,t={}){let s={id:e},r=await this.get("users/:id/blocking",t,{fullResponse:!0,params:s});return new eG({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async userMutingUsers(e,t={}){let s={id:e},r=await this.get("users/:id/muting",t,{fullResponse:!0,params:s});return new eY({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}list(e,t={}){return this.get("lists/:id",t,{params:{id:e}})}async listsOwned(e,t={}){let s={id:e},r=await this.get("users/:id/owned_lists",t,{fullResponse:!0,params:s});return new e6({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listMemberships(e,t={}){let s={id:e},r=await this.get("users/:id/list_memberships",t,{fullResponse:!0,params:s});return new e5({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listFollowed(e,t={}){let s={id:e},r=await this.get("users/:id/followed_lists",t,{fullResponse:!0,params:s});return new e8({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listTweets(e,t={}){let s={id:e},r=await this.get("lists/:id/tweets",t,{fullResponse:!0,params:s});return new eJ({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listMembers(e,t={}){let s={id:e},r=await this.get("lists/:id/members",t,{fullResponse:!0,params:s});return new e0({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listFollowers(e,t={}){let s={id:e},r=await this.get("lists/:id/followers",t,{fullResponse:!0,params:s});return new e1({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listDmEvents(e={}){let t=await this.get("dm_events",e,{fullResponse:!0});return new te({realData:t.data,rateLimit:t.rateLimit,instance:this,queryParams:{...e}})}async listDmEventsWithParticipant(e,t={}){let s={participant_id:e},r=await this.get("dm_conversations/with/:participant_id/dm_events",t,{fullResponse:!0,params:s});return new tt({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}async listDmEventsOfConversation(e,t={}){let s={dm_conversation_id:e},r=await this.get("dm_conversations/:dm_conversation_id/dm_events",t,{fullResponse:!0,params:s});return new ts({realData:r.data,rateLimit:r.rateLimit,instance:this,queryParams:{...t},sharedParams:s})}space(e,t={}){return this.get("spaces/:id",t,{params:{id:e}})}spaces(e,t={}){return this.get("spaces",{ids:e,...t})}spacesByCreators(e,t={}){return this.get("spaces/by/creator_ids",{user_ids:e,...t})}searchSpaces(e){return this.get("spaces/search",e)}spaceBuyers(e,t={}){return this.get("spaces/:id/buyers",t,{params:{id:e}})}spaceTweets(e,t={}){return this.get("spaces/:id/tweets",t,{params:{id:e}})}searchStream({autoConnect:e,...t}={}){return this.getStream("tweets/search/stream",t,{payloadIsError:A,autoConnect:e})}streamRules(e={}){return this.get("tweets/search/stream/rules",e)}updateStreamRules(e,t={}){return this.post("tweets/search/stream/rules",e,{query:t})}sampleStream({autoConnect:e,...t}={}){return this.getStream("tweets/sample/stream",t,{payloadIsError:A,autoConnect:e})}sample10Stream({autoConnect:e,...t}={}){return this.getStream("tweets/sample10/stream",t,{payloadIsError:A,autoConnect:e})}complianceJobs(e){return this.get("compliance/jobs",e)}complianceJob(e){return this.get("compliance/jobs/:id",void 0,{params:{id:e}})}async sendComplianceJob(e){let t=await this.post("compliance/jobs",{type:e.type,name:e.name}),s=e.ids instanceof Buffer?e.ids:Buffer.from(e.ids.join("\n"));return await this.put(t.data.upload_url,s,{forceBodyMode:"raw",enableAuth:!1,headers:{"Content-Type":"text/plain"},prefix:""}),t}async complianceJobResult(e){let t=e;for(;"complete"!==t.status;){if("expired"===t.status||"failed"===t.status)throw Error("Job failed to be completed.");await new Promise(e=>setTimeout(e,3500)),t=(await this.complianceJob(e.id)).data}return(await this.get(e.download_url,void 0,{enableAuth:!1,prefix:""})).trim().split("\n").filter(e=>e).map(e=>JSON.parse(e))}async usage(e={}){return this.get("usage/tweets",e)}community(e,t={}){return this.get("communities/:id",t,{params:{id:e}})}searchCommunities(e,t={}){return this.get("communities/search",{query:e,...t})}}class ti extends e9{constructor(){super(...arguments),this._prefix=i}get readOnly(){return this}}class ta extends tr{constructor(){super(...arguments),this._prefix=r}get readOnly(){return this}get labs(){return this._labs?this._labs:this._labs=new ti(this)}hideReply(e,t){return this.put("tweets/:id/hidden",{hidden:t},{params:{id:e}})}like(e,t){return this.post("users/:id/likes",{tweet_id:t},{params:{id:e}})}unlike(e,t){return this.delete("users/:id/likes/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}retweet(e,t){return this.post("users/:id/retweets",{tweet_id:t},{params:{id:e}})}unretweet(e,t){return this.delete("users/:id/retweets/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}tweet(e,t={}){return t="object"==typeof e?e:{text:e,...t},this.post("tweets",t)}async uploadMedia(e,t,s=1048576){let r=t.media_category;!t.media_category&&(t.media_type.includes("gif")?r="tweet_gif":t.media_type.includes("image")?r="tweet_image":t.media_type.includes("video")&&(r="tweet_video"));let i={additional_owners:t.additional_owners,media_type:t.media_type,total_bytes:e.length,media_category:r},a=(await this.post("media/upload/initialize",i)).data.id,n=Math.ceil(e.length/s),o=new Uint8Array(e);for(let t=0;t<n;t++){let r=t*s,i=Math.min(r+s,e.length),n=o.slice(r,i),l={segment_index:t,media:Buffer.from(n)};await this.post(`media/upload/${a}/append`,l,{forceBodyMode:"form-data"})}return(await this.post(`media/upload/${a}/finalize`)).data.processing_info&&await this.waitForMediaProcessing(a),a}async waitForMediaProcessing(e){var t;let s=(await this.get("media/upload",{command:"STATUS",media_id:e})).data.processing_info;if(s)switch(s.state){case"succeeded":return;case"failed":throw Error(`Media processing failed: ${null===(t=s.error)||void 0===t?void 0:t.message}`);case"pending":case"in_progress":{let t=null==s?void 0:s.check_after_secs;t&&t>0&&(await new Promise(e=>setTimeout(e,1e3*t)),await this.waitForMediaProcessing(e))}}}createMediaMetadata(e,t){return this.post("media/metadata",{id:e,metadata:t})}reply(e,t,s={}){var r;let i={in_reply_to_tweet_id:t,...null!==(r=s.reply)&&void 0!==r?r:{}};return this.post("tweets",{text:e,...s,reply:i})}quote(e,t,s={}){return this.tweet(e,{...s,quote_tweet_id:t})}async tweetThread(e){var t,s;let r=[];for(let i of e){let e=r.length?r[r.length-1]:null,a={..."string"==typeof i?{text:i}:i},n=e?e.data.id:null===(t=a.reply)||void 0===t?void 0:t.in_reply_to_tweet_id,o=null!==(s=a.text)&&void 0!==s?s:"";n?r.push(await this.reply(o,n,a)):r.push(await this.tweet(o,a))}return r}deleteTweet(e){return this.delete("tweets/:id",void 0,{params:{id:e}})}async bookmark(e){let t=await this.getCurrentUserV2Object();return this.post("users/:id/bookmarks",{tweet_id:e},{params:{id:t.data.id}})}async deleteBookmark(e){let t=await this.getCurrentUserV2Object();return this.delete("users/:id/bookmarks/:tweet_id",void 0,{params:{id:t.data.id,tweet_id:e}})}follow(e,t){return this.post("users/:id/following",{target_user_id:t},{params:{id:e}})}unfollow(e,t){return this.delete("users/:source_user_id/following/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}block(e,t){return this.post("users/:id/blocking",{target_user_id:t},{params:{id:e}})}unblock(e,t){return this.delete("users/:source_user_id/blocking/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}mute(e,t){return this.post("users/:id/muting",{target_user_id:t},{params:{id:e}})}unmute(e,t){return this.delete("users/:source_user_id/muting/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}createList(e){return this.post("lists",e)}updateList(e,t={}){return this.put("lists/:id",t,{params:{id:e}})}removeList(e){return this.delete("lists/:id",void 0,{params:{id:e}})}addListMember(e,t){return this.post("lists/:id/members",{user_id:t},{params:{id:e}})}removeListMember(e,t){return this.delete("lists/:id/members/:user_id",void 0,{params:{id:e,user_id:t}})}subscribeToList(e,t){return this.post("users/:id/followed_lists",{list_id:t},{params:{id:e}})}unsubscribeOfList(e,t){return this.delete("users/:id/followed_lists/:list_id",void 0,{params:{id:e,list_id:t}})}pinList(e,t){return this.post("users/:id/pinned_lists",{list_id:t},{params:{id:e}})}unpinList(e,t){return this.delete("users/:id/pinned_lists/:list_id",void 0,{params:{id:e,list_id:t}})}sendDmInConversation(e,t){return this.post("dm_conversations/:dm_conversation_id/messages",t,{params:{dm_conversation_id:e}})}sendDmToParticipant(e,t){return this.post("dm_conversations/with/:participant_id/messages",t,{params:{participant_id:e}})}createDmConversation(e){return this.post("dm_conversations",e)}}class tn extends ti{constructor(){super(...arguments),this._prefix=i}get readWrite(){return this}}class to extends ta{constructor(){super(...arguments),this._prefix=r}get readWrite(){return this}get labs(){return this._labs?this._labs:this._labs=new tn(this)}}class tl extends ee{get v1(){return this._v1?this._v1:this._v1=new ek(this)}get v2(){return this._v2?this._v2:this._v2=new tr(this)}async currentUser(e=!1){return await this.getCurrentUserObject(e)}async currentUserV2(e=!1){return await this.getCurrentUserV2Object(e)}search(e,t){return this.v2.search(e,t)}async generateAuthLink(e="oob",{authAccessType:t,linkMode:s="authenticate",forceLogin:r,screenName:i}={}){let a=await this.post("https://api.x.com/oauth/request_token",{oauth_callback:e,x_auth_access_type:t}),n=`https://api.x.com/oauth/${s}?oauth_token=${encodeURIComponent(a.oauth_token)}`;return void 0!==r&&(n+=`&force_login=${encodeURIComponent(r)}`),void 0!==i&&(n+=`&screen_name=${encodeURIComponent(i)}`),this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth1RequestToken",{client:this._requestMaker,url:n,oauthResult:a}),{url:n,...a}}async login(e){let t=this.getActiveTokens();if("oauth-1.0a"!==t.type)throw Error("You must setup TwitterApi instance with consumer keys to accept OAuth 1.0 login");let s=await this.post("https://api.x.com/oauth/access_token",{oauth_token:t.accessToken,oauth_verifier:e}),r=new t_({appKey:t.appKey,appSecret:t.appSecret,accessToken:s.oauth_token,accessSecret:s.oauth_token_secret},this._requestMaker.clientSettings);return{accessToken:s.oauth_token,accessSecret:s.oauth_token_secret,userId:s.user_id,screenName:s.screen_name,client:r}}async appLogin(){let e=this.getActiveTokens();if("oauth-1.0a"!==e.type)throw Error("You must setup TwitterApi instance with consumer keys to accept app-only login");let t=new t_({username:e.appKey,password:e.appSecret},this._requestMaker.clientSettings);return new t_((await t.post("https://api.x.com/oauth2/token",{grant_type:"client_credentials"})).access_token,this._requestMaker.clientSettings)}generateOAuth2AuthLink(e,t={}){var s,r;if(!this._requestMaker.clientId)throw Error("Twitter API instance is not initialized with client ID. You can find your client ID in Twitter Developer Portal. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let i=null!==(s=t.state)&&void 0!==s?s:Z.generateRandomString(32),a=Z.getCodeVerifier(),n=Z.getCodeChallengeFromVerifier(a),o=null!==(r=t.scope)&&void 0!==r?r:"",l=Array.isArray(o)?o.join(" "):o,u=new URL("https://x.com/i/oauth2/authorize"),c={response_type:"code",client_id:this._requestMaker.clientId,redirect_uri:e,state:i,code_challenge:n,code_challenge_method:"s256",scope:l};Y.addQueryParamsToUrl(u,c);let d={url:u.toString(),state:i,codeVerifier:a,codeChallenge:n};return this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth2RequestToken",{client:this._requestMaker,result:d,redirectUri:e}),d}async loginWithOAuth2({code:e,codeVerifier:t,redirectUri:s}){if(!this._requestMaker.clientId)throw Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let r=await this.post("https://api.x.com/2/oauth2/token",{code:e,code_verifier:t,redirect_uri:s,grant_type:"authorization_code",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(r)}async refreshOAuth2Token(e){if(!this._requestMaker.clientId)throw Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let t=await this.post("https://api.x.com/2/oauth2/token",{refresh_token:e,grant_type:"refresh_token",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(t)}async revokeOAuth2Token(e,t="access_token"){if(!this._requestMaker.clientId)throw Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");return await this.post("https://api.x.com/2/oauth2/revoke",{client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret,token:e,token_type_hint:t})}parseOAuth2AccessTokenResult(e){let t=new t_(e.access_token,this._requestMaker.clientSettings),s=e.scope.split(" ").filter(e=>e);return{client:t,expiresIn:e.expires_in,accessToken:e.access_token,scope:s,refreshToken:e.refresh_token}}}class tu extends tl{get v1(){return this._v1?this._v1:this._v1=new eA(this)}get v2(){return this._v2?this._v2:this._v2=new ta(this)}get readOnly(){return this}}class tc extends et{constructor(){super(...arguments),this._prefix=o}}class td extends tc{constructor(){super(...arguments),this._prefix=o}get readOnly(){return this}}class th extends et{constructor(){super(...arguments),this._prefix=l}}class tp extends th{constructor(){super(...arguments),this._prefix=l}get readOnly(){return this}}class tm extends tp{constructor(){super(...arguments),this._prefix=l}get readWrite(){return this}}class tg extends td{constructor(){super(...arguments),this._prefix=o}get readWrite(){return this}get sandbox(){return this._sandbox?this._sandbox:this._sandbox=new tm(this)}}class tf extends tu{get v1(){return this._v1?this._v1:this._v1=new eI(this)}get v2(){return this._v2?this._v2:this._v2=new to(this)}get readWrite(){return this}get ads(){return this._ads?this._ads:this._ads=new tg(this)}static getErrors(e){var t;return"object"==typeof e&&"data"in e&&null!==(t=e.data.errors)&&void 0!==t?t:[]}static getProfileImageInSize(e,t){let s=e.split("/").pop(),r=e;for(let t of["normal","bigger","mini"])if(s.includes(`_${t}`)){r=e.replace(`_${t}`,"");break}if("original"===t)return r;let i=r.lastIndexOf(".");if(-1===i)return r+"_"+t;{let e=r.slice(i+1);return r.slice(0,i)+"_"+t+"."+e}}}let t_=tf},42343:(e,t,s)=>{s.d(t,{c:()=>e3});var r,i,a,n,o,l,u,c,d,h,p,m,g,f="vercel.ai.error",_=Symbol.for(f),y=class e extends Error{constructor({name:e,message:t,cause:s}){super(t),this[r]=!0,this.name=e,this.cause=s}static isInstance(t){return e.hasMarker(t,f)}static hasMarker(e,t){let s=Symbol.for(t);return null!=e&&"object"==typeof e&&s in e&&"boolean"==typeof e[s]&&!0===e[s]}};r=_;var w=y,v="AI_APICallError",b=`vercel.ai.error.${v}`,R=Symbol.for(b),x=class extends w{constructor({message:e,url:t,requestBodyValues:s,statusCode:r,responseHeaders:a,responseBody:n,cause:o,isRetryable:l=null!=r&&(408===r||409===r||429===r||r>=500),data:u}){super({name:v,message:e,cause:o}),this[i]=!0,this.url=t,this.requestBodyValues=s,this.statusCode=r,this.responseHeaders=a,this.responseBody=n,this.isRetryable=l,this.data=u}static isInstance(e){return w.hasMarker(e,b)}};i=R;var k="AI_EmptyResponseBodyError",S=`vercel.ai.error.${k}`,T=Symbol.for(S),D=class extends w{constructor({message:e="Empty response body"}={}){super({name:k,message:e}),this[a]=!0}static isInstance(e){return w.hasMarker(e,S)}};function E(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}a=T;var q="AI_InvalidArgumentError",L=`vercel.ai.error.${q}`,A=Symbol.for(L),P=class extends w{constructor({message:e,cause:t,argument:s}){super({name:q,message:e,cause:t}),this[n]=!0,this.argument=s}static isInstance(e){return w.hasMarker(e,L)}};n=A,Symbol.for("vercel.ai.error.AI_InvalidPromptError");var I="AI_InvalidResponseDataError",j=`vercel.ai.error.${I}`,M=Symbol.for(j),C=class extends w{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:I,message:t}),this[o]=!0,this.data=e}static isInstance(e){return w.hasMarker(e,j)}};o=M;var F="AI_JSONParseError",O=`vercel.ai.error.${F}`,N=Symbol.for(O),U=class extends w{constructor({text:e,cause:t}){super({name:F,message:`JSON parsing failed: Text: ${e}.
Error message: ${E(t)}`,cause:t}),this[l]=!0,this.text=e}static isInstance(e){return w.hasMarker(e,O)}};l=N,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var B="AI_TypeValidationError",z=`vercel.ai.error.${B}`,H=Symbol.for(z),$=class e extends w{constructor({value:e,cause:t}){super({name:B,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${E(t)}`,cause:t}),this[u]=!0,this.value=e}static isInstance(e){return w.hasMarker(e,z)}static wrap({value:t,cause:s}){return e.isInstance(s)&&s.value===t?s:new e({value:t,cause:s})}};u=H;var W="AI_UnsupportedFunctionalityError",V=`vercel.ai.error.${W}`,K=Symbol.for(V),J=class extends w{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:W,message:t}),this[c]=!0,this.functionality=e}static isInstance(e){return w.hasMarker(e,V)}};function Q(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(Q):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&Q(t)))}c=K;var G=s(16748),Y=s(32425),Z=Object.defineProperty,X=(e,t,s)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,ee=(e,t,s)=>X(e,"symbol"!=typeof t?t+"":t,s);class et extends Error{constructor(e,t){super(e),ee(this,"type"),ee(this,"field"),ee(this,"value"),ee(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function es(e){}class er extends TransformStream{constructor({onError:e,onRetry:t,onComment:s}={}){let r;super({start(i){r=function(e){let{onEvent:t=es,onError:s=es,onRetry:r=es,onComment:i}=e,a="",n=!0,o,l="",u="";function c(e){if(""===e){l.length>0&&t({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u="";return}if(e.startsWith(":")){i&&i(e.slice(e.startsWith(": ")?2:1));return}let s=e.indexOf(":");if(-1!==s){let t=e.slice(0,s),r=" "===e[s+1]?2:1;d(t,e.slice(s+r),e);return}d(e,"",e)}function d(e,t,i){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?r(parseInt(t,10)):s(new et(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:i}));break;default:s(new et(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:i}))}}return{feed:function(e){let t=n?e.replace(/^\xEF\xBB\xBF/,""):e,[s,r]=function(e){let t=[],s="",r=e.length;for(let i=0;i<r;i++){let r=e[i];"\r"===r&&e[i+1]===`
`?(t.push(s),s="",i++):"\r"===r||r===`
`?(t.push(s),s=""):s+=r}return[t,s]}(`${a}${t}`);for(let e of s)c(e);a=r,n=!1},reset:function(e={}){a&&e.consume&&c(a),o=void 0,l="",u="",a=""}}}({onEvent:e=>{i.enqueue(e)},onError(t){"terminate"===e?i.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:s})},transform(e){r.feed(e)}})}}function ei(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function ea(e){let t={};return e.headers.forEach((e,s)=>{t[s]=e}),t}var en=(({prefix:e,size:t=16,alphabet:s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let i=(0,G.k)(s,t);if(null==e)return i;if(s.includes(r))throw new P({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${s}".`});return t=>`${e}${r}${i(t)}`})();function eo(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var el=Symbol.for("vercel.ai.validator");function eu({value:e,schema:t}){let s="object"==typeof t&&null!==t&&el in t&&!0===t[el]&&"validate"in t?t:{[el]:!0,validate:e=>{let s=t.safeParse(e);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}};try{if(null==s.validate)return{success:!0,value:e};let t=s.validate(e);if(t.success)return t;return{success:!1,error:$.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:$.wrap({value:e,cause:t})}}}function ec({text:e,schema:t}){try{let s=Y.parse(e);if(null==t)return{success:!0,value:s,rawValue:s};let r=eu({value:s,schema:t});return r.success?{...r,rawValue:s}:r}catch(t){return{success:!1,error:U.isInstance(t)?t:new U({text:e,cause:t})}}}function ed(e){try{return Y.parse(e),!0}catch(e){return!1}}var eh=()=>globalThis.fetch,ep=async({url:e,headers:t,body:s,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:n})=>em({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(s),values:s},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:a,fetch:n}),em=async({url:e,headers:t={},body:s,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:a,fetch:n=eh()})=>{try{let o=await n(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:s.content,signal:a}),l=ea(o);if(!o.ok){let t;try{t=await i({response:o,url:e,requestBodyValues:s.values})}catch(t){if(eo(t)||x.isInstance(t))throw t;throw new x({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:s.values})}throw t.value}try{return await r({response:o,url:e,requestBodyValues:s.values})}catch(t){if(t instanceof Error&&(eo(t)||x.isInstance(t)))throw t;throw new x({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:s.values})}}catch(t){if(eo(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let r=t.cause;if(null!=r)throw new x({message:`Cannot connect to API: ${r.message}`,cause:r,url:e,requestBodyValues:s.values,isRetryable:!0})}throw t}},eg=({errorSchema:e,errorToMessage:t,isRetryable:s})=>async({response:r,url:i,requestBodyValues:a})=>{let n=await r.text(),o=ea(r);if(""===n.trim())return{responseHeaders:o,value:new x({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:n,isRetryable:null==s?void 0:s(r)})};try{let l=function({text:e,schema:t}){try{let s=Y.parse(e);if(null==t)return s;return function({value:e,schema:t}){let s=eu({value:e,schema:t});if(!s.success)throw $.wrap({value:e,cause:s.error});return s.value}({value:s,schema:t})}catch(t){if(U.isInstance(t)||$.isInstance(t))throw t;throw new U({text:e,cause:t})}}({text:n,schema:e});return{responseHeaders:o,value:new x({message:t(l),url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:n,data:l,isRetryable:null==s?void 0:s(r,l)})}}catch(e){return{responseHeaders:o,value:new x({message:r.statusText,url:i,requestBodyValues:a,statusCode:r.status,responseHeaders:o,responseBody:n,isRetryable:null==s?void 0:s(r)})}}},ef=e=>async({response:t})=>{let s=ea(t);if(null==t.body)throw new D({});return{responseHeaders:s,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new er).pipeThrough(new TransformStream({transform({data:t},s){"[DONE]"!==t&&s.enqueue(ec({text:t,schema:e}))}}))}},e_=e=>async({response:t,url:s,requestBodyValues:r})=>{let i=await t.text(),a=ec({text:i,schema:e}),n=ea(t);if(!a.success)throw new x({message:"Invalid JSON response",cause:a.error,statusCode:t.status,responseHeaders:n,responseBody:i,url:s,requestBodyValues:r});return{responseHeaders:n,value:a.value,rawValue:a.rawValue}},{btoa:ey,atob:ew}=globalThis,ev=s(10692);function eb(e){var t,s;return null!=(s=null==(t=null==e?void 0:e.providerMetadata)?void 0:t.openaiCompatible)?s:{}}function eR({id:e,model:t,created:s}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=s?new Date(1e3*s):void 0}}function ex(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ek={errorSchema:ev.z.object({error:ev.z.object({message:ev.z.string(),type:ev.z.string().nullish(),param:ev.z.any().nullish(),code:ev.z.union([ev.z.string(),ev.z.number()]).nullish()})}),errorToMessage:e=>e.error.message},eS=class{constructor(e,t,s){var r,i;this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=s;let a=null!=(r=s.errorStructure)?r:ek;this.chunkSchema=eD(a.errorSchema),this.failedResponseHandler=eg(a),this.supportsStructuredOutputs=null!=(i=s.supportsStructuredOutputs)&&i}get defaultObjectGenerationMode(){return this.config.defaultObjectGenerationMode}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:s,temperature:r,topP:i,topK:a,frequencyPenalty:n,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c}){var d,h;let p=e.type,m=[];null!=a&&m.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||this.supportsStructuredOutputs||m.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let g={model:this.modelId,user:this.settings.user,max_tokens:s,temperature:r,top_p:i,frequency_penalty:n,presence_penalty:o,response_format:(null==u?void 0:u.type)==="json"?!0===this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,name:null!=(d=u.name)?d:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,messages:function(e){let t=[];for(let{role:s,content:r,...i}of e){let e=eb({...i});switch(s){case"system":t.push({role:"system",content:r,...e});break;case"user":if(1===r.length&&"text"===r[0].type){t.push({role:"user",content:r[0].text,...eb(r[0])});break}t.push({role:"user",content:r.map(e=>{var t;let s=eb(e);switch(e.type){case"text":return{type:"text",text:e.text,...s};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${function(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCodePoint(e[s]);return ey(t)}(e.image)}`},...s};case"file":throw new J({functionality:"File content parts in user messages"})}}),...e});break;case"assistant":{let s="",i=[];for(let e of r){let t=eb(e);switch(e.type){case"text":s+=e.text;break;case"tool-call":i.push({id:e.toolCallId,type:"function",function:{name:e.toolName,arguments:JSON.stringify(e.args)},...t});break;default:throw Error(`Unsupported part: ${e}`)}}t.push({role:"assistant",content:s,tool_calls:i.length>0?i:void 0,...e});break}case"tool":for(let e of r){let s=eb(e);t.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result),...s})}break;default:throw Error(`Unsupported role: ${s}`)}}return t}(t)};switch(p){case"regular":{let{tools:t,tool_choice:s,toolWarnings:r}=function({mode:e,structuredOutputs:t}){var s;let r=(null==(s=e.tools)?void 0:s.length)?e.tools:void 0,i=[];if(null==r)return{tools:void 0,tool_choice:void 0,toolWarnings:i};let a=e.toolChoice,n=[];for(let e of r)"provider-defined"===e.type?i.push({type:"unsupported-tool",tool:e}):n.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}});if(null==a)return{tools:n,tool_choice:void 0,toolWarnings:i};let o=a.type;switch(o){case"auto":case"none":case"required":return{tools:n,tool_choice:o,toolWarnings:i};case"tool":return{tools:n,tool_choice:{type:"function",function:{name:a.toolName}},toolWarnings:i};default:throw new J({functionality:`Unsupported tool choice type: ${o}`})}}({mode:e,structuredOutputs:this.supportsStructuredOutputs});return{args:{...g,tools:t,tool_choice:s},warnings:[...m,...r]}}case"object-json":return{args:{...g,response_format:!0===this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,name:null!=(h=e.name)?h:"response",description:e.description}}:{type:"json_object"}},warnings:m};case"object-tool":return{args:{...g,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]},warnings:m};default:throw Error(`Unsupported type: ${p}`)}}async doGenerate(e){var t,s,r,i,a,n,o,l,u;let{args:c,warnings:d}=this.getArgs({...e}),h=JSON.stringify(c),{responseHeaders:p,value:m,rawValue:g}=await ep({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ei(this.config.headers(),e.headers),body:c,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:e_(eT),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,..._}=c,y=m.choices[0],w=null==(s=null==(t=this.config.metadataExtractor)?void 0:t.extractMetadata)?void 0:s.call(t,{parsedBody:g});return{text:null!=(r=y.message.content)?r:void 0,reasoning:null!=(i=y.message.reasoning_content)?i:void 0,toolCalls:null==(a=y.message.tool_calls)?void 0:a.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:en(),toolName:e.function.name,args:e.function.arguments}}),finishReason:ex(y.finish_reason),usage:{promptTokens:null!=(o=null==(n=m.usage)?void 0:n.prompt_tokens)?o:NaN,completionTokens:null!=(u=null==(l=m.usage)?void 0:l.completion_tokens)?u:NaN},...w&&{providerMetadata:w},rawCall:{rawPrompt:f,rawSettings:_},rawResponse:{headers:p},response:eR(m),warnings:d,request:{body:h}}}async doStream(e){var t;if(this.settings.simulateStreaming){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.reasoning&&e.enqueue({type:"reasoning",textDelta:t.reasoning}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let s of t.toolCalls)e.enqueue({type:"tool-call",...s});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:s,warnings:r}=this.getArgs({...e}),i=JSON.stringify({...s,stream:!0}),a=null==(t=this.config.metadataExtractor)?void 0:t.createStreamExtractor(),{responseHeaders:n,value:o}=await ep({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:ei(this.config.headers(),e.headers),body:{...s,stream:!0},failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:ef(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:l,...u}=s,c=[],d="unknown",h={promptTokens:void 0,completionTokens:void 0},p=!0;return{stream:o.pipeThrough(new TransformStream({transform(e,t){var s,r,i,n,o,l,u,m,g,f,_,y,w,v;if(!e.success){d="error",t.enqueue({type:"error",error:e.error});return}let b=e.value;if(null==a||a.processChunk(e.rawValue),"error"in b){d="error",t.enqueue({type:"error",error:b.error.message});return}p&&(p=!1,t.enqueue({type:"response-metadata",...eR(b)})),null!=b.usage&&(h={promptTokens:null!=(s=b.usage.prompt_tokens)?s:void 0,completionTokens:null!=(r=b.usage.completion_tokens)?r:void 0});let R=b.choices[0];if((null==R?void 0:R.finish_reason)!=null&&(d=ex(R.finish_reason)),(null==R?void 0:R.delta)==null)return;let x=R.delta;if(null!=x.reasoning_content&&t.enqueue({type:"reasoning",textDelta:x.reasoning_content}),null!=x.content&&t.enqueue({type:"text-delta",textDelta:x.content}),null!=x.tool_calls)for(let e of x.tool_calls){let s=e.index;if(null==c[s]){if("function"!==e.type)throw new C({data:e,message:"Expected 'function' type."});if(null==e.id)throw new C({data:e,message:"Expected 'id' to be a string."});if((null==(i=e.function)?void 0:i.name)==null)throw new C({data:e,message:"Expected 'function.name' to be a string."});c[s]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(n=e.function.arguments)?n:""},hasFinished:!1};let r=c[s];(null==(o=r.function)?void 0:o.name)!=null&&(null==(l=r.function)?void 0:l.arguments)!=null&&(r.function.arguments.length>0&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.id,toolName:r.function.name,argsTextDelta:r.function.arguments}),ed(r.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(u=r.id)?u:en(),toolName:r.function.name,args:r.function.arguments}),r.hasFinished=!0));continue}let r=c[s];!r.hasFinished&&((null==(m=e.function)?void 0:m.arguments)!=null&&(r.function.arguments+=null!=(f=null==(g=e.function)?void 0:g.arguments)?f:""),t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.id,toolName:r.function.name,argsTextDelta:null!=(_=e.function.arguments)?_:""}),(null==(y=r.function)?void 0:y.name)!=null&&(null==(w=r.function)?void 0:w.arguments)!=null&&ed(r.function.arguments)&&(t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(v=r.id)?v:en(),toolName:r.function.name,args:r.function.arguments}),r.hasFinished=!0))}},flush(e){var t,s;let r=null==a?void 0:a.buildMetadata();e.enqueue({type:"finish",finishReason:d,usage:{promptTokens:null!=(t=h.promptTokens)?t:NaN,completionTokens:null!=(s=h.completionTokens)?s:NaN},...r&&{providerMetadata:r}})}})),rawCall:{rawPrompt:l,rawSettings:u},rawResponse:{headers:n},warnings:r,request:{body:i}}}},eT=ev.z.object({id:ev.z.string().nullish(),created:ev.z.number().nullish(),model:ev.z.string().nullish(),choices:ev.z.array(ev.z.object({message:ev.z.object({role:ev.z.literal("assistant").nullish(),content:ev.z.string().nullish(),reasoning_content:ev.z.string().nullish(),tool_calls:ev.z.array(ev.z.object({id:ev.z.string().nullish(),type:ev.z.literal("function"),function:ev.z.object({name:ev.z.string(),arguments:ev.z.string()})})).nullish()}),finish_reason:ev.z.string().nullish()})),usage:ev.z.object({prompt_tokens:ev.z.number().nullish(),completion_tokens:ev.z.number().nullish()}).nullish()}),eD=e=>ev.z.union([ev.z.object({id:ev.z.string().nullish(),created:ev.z.number().nullish(),model:ev.z.string().nullish(),choices:ev.z.array(ev.z.object({delta:ev.z.object({role:ev.z.enum(["assistant"]).nullish(),content:ev.z.string().nullish(),reasoning_content:ev.z.string().nullish(),tool_calls:ev.z.array(ev.z.object({index:ev.z.number(),id:ev.z.string().nullish(),type:ev.z.literal("function").optional(),function:ev.z.object({name:ev.z.string().nullish(),arguments:ev.z.string().nullish()})})).nullish()}).nullish(),finish_reason:ev.z.string().nullish()})),usage:ev.z.object({prompt_tokens:ev.z.number().nullish(),completion_tokens:ev.z.number().nullish()}).nullish()}),e]),eE=(ev.z.object({id:ev.z.string().nullish(),created:ev.z.number().nullish(),model:ev.z.string().nullish(),choices:ev.z.array(ev.z.object({text:ev.z.string(),finish_reason:ev.z.string()})),usage:ev.z.object({prompt_tokens:ev.z.number(),completion_tokens:ev.z.number()}).nullish()}),ev.z.object({data:ev.z.array(ev.z.object({embedding:ev.z.array(ev.z.number())})),usage:ev.z.object({prompt_tokens:ev.z.number()}).nullish()}),"vercel.ai.error"),eq=Symbol.for(eE),eL=class e extends Error{constructor({name:e,message:t,cause:s}){super(t),this[d]=!0,this.name=e,this.cause=s}static isInstance(t){return e.hasMarker(t,eE)}static hasMarker(e,t){let s=Symbol.for(t);return null!=e&&"object"==typeof e&&s in e&&"boolean"==typeof e[s]&&!0===e[s]}};d=eq;var eA=eL,eP=(Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),"AI_InvalidArgumentError"),eI=`vercel.ai.error.${eP}`,ej=Symbol.for(eI),eM=class extends eA{constructor({message:e,cause:t,argument:s}){super({name:eP,message:e,cause:t}),this[h]=!0,this.argument=s}static isInstance(e){return eA.hasMarker(e,eI)}};h=ej,Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),Symbol.for("vercel.ai.error.AI_JSONParseError");var eC="AI_LoadAPIKeyError",eF=`vercel.ai.error.${eC}`,eO=Symbol.for(eF),eN=class extends eA{constructor({message:e}){super({name:eC,message:e}),this[p]=!0}static isInstance(e){return eA.hasMarker(e,eF)}};p=eO,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var eU="AI_NoSuchModelError",eB=`vercel.ai.error.${eU}`,ez=Symbol.for(eB),eH=class extends eA{constructor({errorName:e=eU,modelId:t,modelType:s,message:r=`No such ${s}: ${t}`}){super({name:e,message:r}),this[m]=!0,this.modelId=t,this.modelType=s}static isInstance(e){return eA.hasMarker(e,eB)}};m=ez,Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var e$="AI_TypeValidationError",eW=`vercel.ai.error.${e$}`,eV=Symbol.for(eW),eK=class e extends eA{constructor({value:e,cause:t}){super({name:e$,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${function(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}(t)}`,cause:t}),this[g]=!0,this.value=e}static isInstance(e){return eA.hasMarker(e,eW)}static wrap({value:t,cause:s}){return e.isInstance(s)&&s.value===t?s:new e({value:t,cause:s})}};function eJ(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(eJ):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&eJ(t)))}g=eV,Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError"),(({prefix:e,size:t=16,alphabet:s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let i=(0,G.k)(s,t);if(null!=e){if(s.includes(r))throw new eM({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${s}".`});return t=>`${e}${r}${i(t)}`}})();var eQ=Symbol.for("vercel.ai.validator");function eG({value:e,schema:t}){let s="object"==typeof t&&null!==t&&eQ in t&&!0===t[eQ]&&"validate"in t?t:{[eQ]:!0,validate:e=>{let s=t.safeParse(e);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}};try{if(null==s.validate)return{success:!0,value:e};let t=s.validate(e);if(t.success)return t;return{success:!1,error:eK.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:eK.wrap({value:e,cause:t})}}}var{btoa:eY,atob:eZ}=globalThis,eX=e=>{var t,s;return null==e?void 0:{deepseek:{promptCacheHitTokens:null!=(t=e.prompt_cache_hit_tokens)?t:NaN,promptCacheMissTokens:null!=(s=e.prompt_cache_miss_tokens)?s:NaN}}},e0={extractMetadata:({parsedBody:e})=>{let t=eG({value:e,schema:e2});return t.success&&null!=t.value.usage?eX(t.value.usage):void 0},createStreamExtractor:()=>{let e;return{processChunk:t=>{var s,r;let i=eG({value:t,schema:e4});i.success&&(null==(r=null==(s=i.value.choices)?void 0:s[0])?void 0:r.finish_reason)==="stop"&&i.value.usage&&(e=i.value.usage)},buildMetadata:()=>eX(e)}}},e1=ev.z.object({prompt_cache_hit_tokens:ev.z.number().nullish(),prompt_cache_miss_tokens:ev.z.number().nullish()}),e2=ev.z.object({usage:e1.nullish()}),e4=ev.z.object({choices:ev.z.array(ev.z.object({finish_reason:ev.z.string().nullish()})).nullish(),usage:e1.nullish()}),e3=function(e={}){var t,s;let r=null==(s=null!=(t=e.baseURL)?t:"https://api.deepseek.com/v1")?void 0:s.replace(/\/$/,""),i=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:s="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new eN({message:`${r} API key must be a string.`});if("undefined"==typeof process)throw new eN({message:`${r} API key is missing. Pass it using the '${s}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new eN({message:`${r} API key is missing. Pass it using the '${s}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new eN({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"DEEPSEEK_API_KEY",description:"DeepSeek API key"})}`,...e.headers}),a=(t,s={})=>new eS(t,s,{provider:"deepseek.chat",url:({path:e})=>`${r}${e}`,headers:i,fetch:e.fetch,defaultObjectGenerationMode:"json",metadataExtractor:e0}),n=(e,t)=>a(e,t);return n.languageModel=a,n.chat=a,n.textEmbeddingModel=e=>{throw new eH({modelId:e,modelType:"textEmbeddingModel"})},n}()}};